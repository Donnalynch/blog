<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
        <link href="/css/site.css" type="text/css" rel="stylesheet"/>
        <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
        <link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Atom feed">
        <title>(think) - Blogs posts</title>

        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-22917580-1']);
            _gaq.push(['_trackPageview']);

            (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();

        </script>
    </head>

    <body>
        <div id="page">
            <div id="content">
                <div id="header">
                    <h1>(think)</h1>
                    <p class="comment">/** An online novel about the Source, the Force, the real life and everything
                    in between...**/</p>
                </div>
                <div id="middle">
                    <div id="menu">
                        <ul id="list-nav">
                            <li><a href="/index.html">Home</a></li>
                            <li><a href="/archive.html">Archive</a></li>
                            <li><a href="/projects.html">Projects</a></li>
                            <li><a href="/about.html">About</a></li>
                            <li><a href="/contacts.html">Contacts</a></li>
                        </ul>
                    </div>
                    <div id="content">
                        
<h2 id="fedora-15-post-installation-setup--tipslinuxfedora20110531fedora-15-tipshtml"><a href="/Linux/Fedora/2011/05/31/fedora-15-tips.html">Fedora 15 post installation setup &amp; tips</a></h2>
<h1 id="overture">Overture</h1>

<p>I’ve recently upgraded all my systems to Fedora 15. The default
installation is not very usable for some tasks for several reasons -
like CD size limitations and software patents for instance. I also
happen to disagree with some defaults in Fedora like the fact that
sudo is not enabled by default (like in Ubuntu) and the use of the
bash shell. In this article I’ll share some of the things I do after a
fresh Fedora 15 installation to enhance it (at least by my standards).</p>

<h1 id="tweak-defaults">Tweak defaults</h1>

<p><strong>Configure sudo</strong></p>

<p>sudo gives you a way to execute single commands as the superuser. You
can also do this with “su -c”, but you have to quote the commands there,
which I don’t like very much. To enable sudo for some account first
run the command:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> su -c <span class="s2">&quot;visudo&quot;</span>
</code></pre>
</div>

<p>The file /etc/sudoers will open up in a customized vi editor. Append
somewhere to the end of the file the following line:</p>

<p><code>username ALL=(ALL) ALL</code></p>

<p>You should replace <em>username</em> with your username.</p>

<p><strong>Configure yum</strong></p>

<p>yum has a lot of plugins, but one of them is particularly useful - the
fastest mirror plug-in. You can install it like this:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install yum-plugin-fastestmirror
</code></pre>
</div>

<p><strong>Disable SELinux</strong></p>

<p>If you’re a desktop Linux user you want to disable SELinux - trust
me. Open the file /etc/selinux/config and change this line:</p>

<p><code>SELINUX=enforcing</code></p>

<p>to</p>

<p><code>SELINUX=disabled</code></p>

<p>Restart afterwards.</p>

<h1 id="install-additional-software">Install additional software</h1>

<p>Fedora’s default installation medium is a 700MB CD. It’s
understandable that not everything can be fitted in there. Luckily
adding new software from the vast Fedora on-line repos is child’s play.</p>

<p><strong>Install REAL text editors</strong></p>

<p>gedit is ok for causal text editing, but professionals like software
engineers and system administrators will definitely need something more:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install emacs vim
</code></pre>
</div>

<p>Personally I use Emacs most of the time and use vim only to edit
config files that require root access. </p>

<p><strong>Install Z Shell</strong></p>

<p>It’s no secret that I love the Z Shell - after all I <a href="/Z%20Shell/2011/04/29/one-shell-to-rule-them-all.html">rave about it</a>
quite often. It should come as no surprise that I happen to use it
and probably you should start using it as well:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install zsh
<span class="gp">$</span> sudo vim /etc/passwd
</code></pre>
</div>

<p>Find the line about your account and change there /bin/bash to
/bin/zsh. Afterwards start a new login shell and a simple wizard will
fire up asking you some questions to create a default .zshrc file for you.</p>

<p><strong>Install LibreOffice</strong></p>

<p>LibreOffice is currently the best Linux option for word processing,
spreadsheet handling and presentation creation. You can install the
most common components with the following command:</p>

<div class="highlight"><pre><code class="console"><span class="go">sudo yum install libreoffice-calc libreoffice-impress libreoffice-draw libreoffice-writer</span>
</code></pre>
</div>

<p>LibreOffice uses hunspell to do spellchecking. An English dictionary
will be installed by default, but you’ll need to install additional
dictionaries manually:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install hunspell-bg
</code></pre>
</div>

<p>This command will install the Bulgarian hunspell dictionary. You
likely don’t need it so install some more helpful dictionary instead. :-)</p>

<p><strong>Install OpenJDK</strong></p>

<p>If you need to run Java programs/applets:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install java-1.6.0-openjdk java-1.6.0-openjdk-plugin
</code></pre>
</div>

<p>If you’re planning to do some Java development:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install java-1.6.0-openjdk-devel java-1.6.0-openjdk-javadoc java-1.6.0-openjdk-src
</code></pre>
</div>

<p><strong>Install Deluge torrent client</strong></p>

<p>The default Transmission torrent client is pretty basic. I recommend
you to replace it with the much more feature-rich deluge:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install deluge
</code></pre>
</div>

<h1 id="install-additional-patent-encumberedproprietary-software">Install additional patent encumbered/proprietary software</h1>

<p><strong>Enable RPMFusion</strong></p>

<p>RPMFusion is the most popular third party repository for Fedora. It’s
full of goodness like audio/video codecs, proprietary drivers, etc. To
enable it just run the following command:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum localinstall --nogpgcheck <span class="se">\</span>
<span class="go">http://download1.rpmfusion.org/free/fedora/rpmfusion-free-release-stable.noarch.rpm \</span>
<span class="go">http://download1.rpmfusion.org/nonfree/fedora/rpmfusion-nonfree-release-stable.noarch.rpm</span>
</code></pre>
</div>

<p><strong>Install proprietary codecs</strong></p>

<p>No MP3 support in Fedora by default? And almost no video codecs?
RPMFusion to the rescue! Type this:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install gstreamer-plugins-ugly gstreamer-plugins-bad gstreamer-ffmpeg
</code></pre>
</div>

<p><strong>Install VLC</strong></p>

<p>With MPlayer’s development in stagnation VLC has established itself as
the best video player for Linux recently. It’s in RPMFusion, so if you
enabled it installing it is as easy as typing the following command:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install vlc
</code></pre>
</div>

<p><strong>Install Adobe Flash Player</strong></p>

<p>Love it or hate it - you probably need it.</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo rpm -Uvh http://linuxdownload.adobe.com/adobe-release/adobe-release-i386-1.0-1.noarch.rpm
<span class="gp">$</span> sudo yum install flash-plug-in
</code></pre>
</div>

<p>You can omit this if you’re planning to use Google Chrome, since it
comes with Flash Player built-in.</p>

<p><strong>Install Skype</strong></p>

<p>Download Skype from the
<a href="http://www.skype.com/intl/en/get-skype/on-your-computer/linux/downloading.fedora">official site</a>. Assuming
you’ve downloaded it to ~/Downloads, you can install it like this:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum localinstall Downloads/skype-2.2.0.25-fedora.i586.rpm
</code></pre>
</div>

<p>Yum will automatically installed any dependencies required by skype.</p>

<p><strong>Install Oracle JDK</strong></p>

<p>OpenJDK is great, but due to licensing problems it’s not quite the
same as the Oracle JDK. If you start experiencing strange problems
(mostly in Swing programs) you’d probably do well to try the Oracle
JDK instead. Download Oracle’s JDK from the
<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html">official site</a>. Select
“Linux x86 - RPM Installer” or “Linux x64 - RPM Installer” depending
on your distribution and install the JDK like this:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo sh jre-6u25-linux-i586-rpm.bin
</code></pre>
</div>

<p>Fedora uses OpenJDK by default, so you’ll have to do some more work to
tell it to start using Oracle JDK. The <strong>alternatives</strong> program allows
you to select between multiple installed versions of a program:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo alternatives --install /usr/bin/java java /usr/java/default/bin/java 1000
<span class="gp">$</span> sudo alternatives --install /usr/bin/javac javac /usr/java/default/bin/javac 1000
<span class="gp">$</span> sudo alternatives --install /usr/bin/javaws javaws /usr/java/default/bin/javaws 1000
</code></pre>
</div>

<p>These commands will make alternative aware of the java binaries and
set high priorities to them which will make them the default Java
binaries. You can use “alternatives –config binaryname” to select
active binaries manually.</p>

<p><strong>Install Google Chrome</strong></p>

<p>Firefox is dying, Google Chrome is the new king of the
browsers. Download it from the <a href="http://www.google.com/chrome">official site</a> and install it:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum localinstall ~/Downloads/google-chrome-stable_current_i386.rpm
</code></pre>
</div>

<p>Google Chrome will install a yum repository as well, so you’ll receive
updates as soon as they arrive.</p>

<p><strong>Install DropBox</strong></p>

<p><a href="http://www.dropbox.com">DropBox</a> is a great file sharing service
which allows you to sync files between all of your computers and
mobile devices(Android, iPhone, iPad, etc). It has a great Linux
client which I use all the time. Download it from
<a href="http://www.dropbox.com/downloading?os=lnx">here</a> and install it like
this:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum localinstall --nogpgcheck nautilus-dropbox-0.6.7-1.fedora.i386.rpm
</code></pre>
</div>

<h1 id="epilogue">Epilogue</h1>

<p>Hopefully some of my setup has made your setup more enjoyable and more
productive. I’ll update this article along the way if I stumble upon
other things that I consider to be generally helpful.</p>

<div style="font-style: italic; color: #7f9f7f;">Posted on 31 May 2011 by Bozhidar.</div>

<p><a href="/Linux/Fedora/2011/05/31/fedora-15-tips.html#disqus_thread">Comments</a></p>

<h2 id="javanext---jruby-the-rubyists-strike-backrubyjava20110518jvm-langs-jrubyhtml"><a href="/Ruby/Java/2011/05/18/jvm-langs-jruby.html">Java.next() - JRuby: The Rubyists Strike Back</a></h2>
<h1 id="overture">Overture</h1>

<p>So far in the Java.next() series I’ve discussed only languages that
were engineered from the start to run on the JVM (<a href="/Java/Groovy/2011/05/06/jvm-langs-groovy.html">Groovy</a>, <a href="/Java/Scala/2011/05/08/jvm-langs-scala.html">Scala</a> and
<a href="/Clojure/Java/2011/05/12/jvm-langs-clojure.html">Clojure</a>). However, a lot of good programming languages existed even
before the inception of the idea to run languages other than Java on top of
the JVM. Some notable examples are Ruby and Python for instance. Today
I’ll be writing about <a href="http://jruby.org/">JRuby</a> - the pure Java port of the Ruby
programming language (and undoubtedly the most advanced and widely
adopted of the 9 (!) actively maintained Ruby ports).</p>

<p>This post will differ somewhat from the others so far, because I won’t
be spending any time to dwell on the basic Ruby syntax and will only
highlight the advantages over plain old Ruby that JRuby provides -
like calling Java code from a Ruby application and scripting Ruby from a
Java application.</p>

<h1 id="why-jruby">Why JRuby?</h1>

<p>Ruby has long been known as one of the most elegant programming
languages out there. With the rise of the Rails web framework several
years ago the language was propelled into the mainstream and showed a
lot of common developers alternative (better) ways to get their jobs done with
less hassle and more grace. While the language is generally well liked
(albeit is has some syntax quirks and oddities, mostly courtesy of its
Perl heritage) its default execution environment MRI (Matz’s Ruby
Interpreter) is not the object of international affection. As an
application written in C it suffers some portability problems (a few
years ago it was quite hard to get MRI to run properly on Windows and
even now you might run into some missing dll error from time to
time). MRI’s performance is not stellar either and it even used to be
quite terrible before the advent of Ruby 1.9 which incorporated YARV
(Yet Another Ruby VM), which significantly improved its performance
(but still left a what to be desired). There is also the problem with
the missing standard portable GUI development library and the somewhat
limited deployment options because of MRI’s limited
portability. </p>

<p>Matz’s has often said that he’s no VM specialist, he’s a
language architect/designer and the beauty of the language concerns
him more than the performance of the reference implementation. He’s
also said that he loves diversity and is certain that interested
parties will offer high quality alternatives to the standard Ruby
runtime. </p>

<p>When it comes down to a high quality runtimes few people don’t start
thinking immediately about the Java platform, known for its infinite
(not literally infinite of course, but vast enough) libraries,
rock-solid and secure JVM and great support for compile-time and
runtime performance
optimizations. It’s not unheard for a Java application to match and
excel the performance of a native C application by employing
techniques like <em>just in time</em>(JIT) compilation, hot spot detection and
optimizations, etc.</p>

<p>So it’s only natural that at some point a bunch of people decided to
create a version of Ruby that could run on top of the acclaimed
JVM. This version of Ruby is (believe it or not) known as JRuby. With
JRuby you get the best of both Java and the Ruby worlds. Here are just a few possibilities:</p>

<ul>
  <li>Deploy a Ruby on Rails web application to Google’s App Engine
service.</li>
  <li>Write a Rails web frontend to your existing Java enterprise
application.</li>
  <li>Target the latest Android smartphones with your Ruby code using <a href="http://ruboto.org/">Ruboto</a></li>
  <li>Create cross-platform GUIs with Java’s Swing (or SWT)</li>
  <li>Build your project on solid libraries written in Java, Scala, Clojure,
or other JVM languages.</li>
  <li>Use the solid platform independent JDBC database
drivers. Platform dependent drivers used with MRI Ruby are a common
source of gripe for developers trying to migrate an application from
one platform to another.</li>
</ul>

<p>Great prospects indeed! Now it’s about time to get that magical piece
of software called JRuby up and running…</p>

<h1 id="installing-jruby">Installing JRuby</h1>

<p>There are several options to consider in the department of JRuby
installation. JRuby requires a Java runtime 5.0+ to be installed. You
can get one from <a href="http://www.oracle.com/technetwork/java/index.html">here</a>.</p>

<p><strong>Using an Installer</strong></p>

<p>The easiest way to install JRuby is to use one of the prebuilt installers
available from the <a href="http://jruby.org/download">official download site</a>. These will take care of the
low level of detail, such as setting up your <strong>PATH</strong> environment
variable to make finding JRuby easier.
The JRuby team currently maintains installers for Windows and Mac
machines. If you’re on Linux, your distribution may package its own
JRuby build. For example, on Ubuntu (or any other Debian derived
distro) you can type this:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo apt-get install jruby
</code></pre>
</div>

<p>Red Had distribution users might try this incantation instead:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> sudo yum install jruby
</code></pre>
</div>

<p>Most Linux distributions don’t upgrade to the latest JRuby release the
instant it comes out. If you want to stay with the latest and greatest,
you might prefer installing from an archive instead or RVM instead.</p>

<p><strong>Using RVM</strong></p>

<p>Most Ruby hackers
favour a powerful bash script called RVM(Ruby Version Manager) that
allows you to install several different version(or flavours of Ruby)
and switch easily between them. Please refer to the official
<a href="https://rvm.beginrescueend.com/">RVM documentation</a> for installation
and usage instructions. After you’ve installed RVM getting JRuby
installed is a child’s play:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> rvm list known | grep jruby
<span class="go">jruby-1.2.0</span>
<span class="go">jruby-1.3.1</span>
<span class="go">jruby-1.4.0</span>
<span class="go">jruby-1.6.0</span>
<span class="go">jruby[-1.6.1]</span>
<span class="go">jruby-head</span>

<span class="gp">$</span> rvm install jruby
<span class="gp">$</span> rvm use jruby
</code></pre>
</div>

<p>Just for the record - I personally use RVM and I recommend to all
*BSD, Linux &amp; OS X hackers to try it out as well - great piece of
software. One of the nicer side effects of using RVM is that you won’t
have to run operations like <strong>gem install</strong> as the root user.</p>

<p><strong>Using prebuilt archive</strong></p>

<p>If you have a heavily customized setup or just like doing things
yourself, you can get a .zip or .tar.gz archive from the same download
page. Extract the archive somewhere convenient on your system, such
as <strong>C:** or **/opt</strong>. You can run JRuby straight from its own <em>bin</em>
folder, but you’ll probably find it more convenient to add it to
your PATH. On UNIX (including Linux &amp; Mac OS X), you can do the following:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> <span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PATH</span>:/opt/jruby/bin
</code></pre>
</div>

<p><strong>Testing the installation</strong></p>

<p>Type the following commands:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> which jruby
<span class="go">~/.rvm/rubies/jruby-1.6.1/bin/jruby</span>
<span class="gp">$</span> jruby -version
<span class="go">jruby 1.6.1 (ruby-1.8.7-p330) (2011-04-12 85838f6) (Java HotSpot(TM) Server VM 1.6.0_22) [linux-i386-java]</span>
<span class="gp">$</span> jruby -e <span class="s1">&#39;puts &quot;Hello, JRuby!&quot;&#39;</span>
<span class="go">Hello, JRuby!</span>
</code></pre>
</div>

<p>Now we can see some of the unique JRuby features in action.</p>

<h1 id="common-tasks-with-jruby">Common tasks with JRuby</h1>

<p><strong>REPL</strong></p>

<p>JRuby comes with an equivalent of the standard Ruby REPL irb, called
jirb. To start it simply type:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> jirb
</code></pre>
</div>

<p>Now you can do some interactive Ruby development:</p>

<div class="highlight"><pre><code class="irb"><span class="go">jruby-1.6.1 :001 &gt; puts &quot;Hello, JRuby&quot;</span>
<span class="go">Hello, JRuby</span>
<span class="go"> =&gt; nil </span>
<span class="go">jruby-1.6.1 :002 &gt; arr = [&quot;Chuck&quot;, &quot;Sarah&quot;, &quot;Morgan&quot;, &quot;Casey&quot;]</span>
<span class="go"> =&gt; [&quot;Chuck&quot;, &quot;Sarah&quot;, &quot;Morgan&quot;, &quot;Casey&quot;] </span>
<span class="go">jruby-1.6.1 :003 &gt; arr.length</span>
<span class="go"> =&gt; 4 </span>
<span class="go">jruby-1.6.1 :004 &gt; arr.size</span>
<span class="go"> =&gt; 4 </span>
<span class="go">jruby-1.6.1 :005 &gt; arr.size()</span>
<span class="go"> =&gt; 4 </span>
<span class="go">jruby-1.6.1 :006 &gt; arr.each { |name| puts name }</span>
<span class="go">Chuck</span>
<span class="go">Sarah</span>
<span class="go">Morgan</span>
<span class="go">Casey</span>
<span class="go"> =&gt; [&quot;Chuck&quot;, &quot;Sarah&quot;, &quot;Morgan&quot;, &quot;Casey&quot;] </span>
<span class="go">jruby-1.6.1 :007 &gt; arr.each_with_index { |name, index| puts &quot;#{index}: #{name}&quot;}</span>
<span class="go">0: Chuck</span>
<span class="go">1: Sarah</span>
<span class="go">2: Morgan</span>
<span class="go">3: Casey</span>
<span class="go"> =&gt; [&quot;Chuck&quot;, &quot;Sarah&quot;, &quot;Morgan&quot;, &quot;Casey&quot;] </span>
</code></pre>
</div>

<p>jirb is a great tool for exploratory programming and has some nice
features like TAB completion. Use it often!</p>

<p><strong>Running scripts</strong></p>

<p>Same as before (with MRI Ruby):</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> jruby some_script.rb
</code></pre>
</div>

<p>That was simple, right?</p>

<p><strong>Running Ruby tools</strong></p>

<p>You should prefix calls to common Ruby tools like gem and rake with
<strong>jruby -S</strong> - otherwise they might get confused which Ruby version
(if you have more than one Ruby installed, that is) to use:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> jruby -S gem install rails
<span class="gp">$</span> jruby -S rake install
</code></pre>
</div>

<p><strong>Using the JRuby compiler</strong></p>

<p>You can compile Ruby scripts directly to Java bytecode and run the
resulting class files using the JVM:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> jrubyc hello.rb
<span class="go">Compiling hello.rb to class example</span>
</code></pre>
</div>

<p>The compiler supplies a main method for you, so you can now run the
program straight from the java command (adjust the path here to point
to your JRuby installation):</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> java -cp .:/opt/jruby/lib/hello.jar example
</code></pre>
</div>

<p>Note that your compiled program still depends on some JRuby-defined
support routines, so jruby.jar needs to be on your classpath. Also,
the compiler compiles only the files you specifically pass to it. If
you reference some_ruby_library.rb from hello.rb, you’ll have to
compile that extra .rb file yourself or ship it in source form
alongside your .class file. The Java compiler understands dependencies
between source files and compiles them automatically so Java
developers should keep this difference in mind.</p>

<h1 id="using-java-from-jruby">Using Java from JRuby</h1>

<p>One of the nicest features of JRuby is undoubtedly the ability to use
Java libraries directly in your Ruby code. JRuby goes a long way to
make the Java classes integrate into normal Ruby code as seamlessly as
possible - for instance it gives you the ability to call methods using the
snake_naming_convention, instead of the common in Java
camelCaseNamingConvention. Let’s see the Java integration in action:</p>

<div class="highlight"><pre><code class="ruby"><span class="nb">require</span> <span class="s1">&#39;java&#39;</span>
<span class="n">java_import</span> <span class="s1">&#39;java.lang.System&#39;</span>
<span class="n">java_import</span> <span class="s1">&#39;java.util.ArrayList&#39;</span>
<span class="n">java_import</span> <span class="s1">&#39;javax.swing.JOptionPane&#39;</span>

<span class="no">System</span><span class="o">.</span><span class="n">out</span><span class="o">.</span><span class="n">println</span><span class="p">(</span><span class="s2">&quot;Feel the power of JRuby&quot;</span><span class="p">)</span>

<span class="c1"># using snake_names for Java method names</span>
<span class="nb">puts</span> <span class="no">System</span><span class="o">.</span><span class="n">current_time_millis</span>
<span class="c1"># regular names work as well</span>
<span class="nb">puts</span> <span class="no">System</span><span class="o">.</span><span class="n">currentTimeMillis</span>

<span class="n">array_list</span> <span class="o">=</span> <span class="no">ArrayList</span><span class="o">.</span><span class="n">new</span>

<span class="c1"># the array list supports some common Ruby idioms</span>
<span class="n">array_list</span> <span class="o">&lt;&lt;</span> <span class="mi">1</span>
<span class="n">array_list</span><span class="o">.</span><span class="n">add</span> <span class="mi">2</span>
<span class="n">array_list</span> <span class="o">&lt;&lt;</span> <span class="mi">3</span>

<span class="nb">puts</span> <span class="s2">&quot;List length is </span><span class="si">#{</span><span class="n">array_list</span><span class="o">.</span><span class="n">length</span><span class="si">}</span><span class="s2">&quot;</span>

<span class="n">array_list</span><span class="o">.</span><span class="n">each</span> <span class="p">{</span> <span class="o">|</span><span class="n">elem</span><span class="o">|</span> <span class="nb">puts</span> <span class="n">elem</span> <span class="p">}</span>

<span class="c1"># a glimpse of Swing</span>
<span class="no">JOptionPane</span><span class="o">.</span><span class="n">show_message_dialog</span><span class="p">(</span><span class="kp">nil</span><span class="p">,</span> <span class="s2">&quot;This is a message from the future of Ruby!&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>You shouldn’t, of course, use ArrayList unless you’re using a Java API
that is requiring you to do so. Hopefully these simple examples gave
you an idea how easy it is to access Java code from JRuby.</p>

<p>It might be tempting to think of Java/Ruby integration as nothing more
than calling from one language to another. That’s not the case. In a
typical project, you’re really interacting with both platforms.  You
might construct a Ruby object, pass it to a Java function, and watch
the Java code call other Ruby methods you’ve defined. All the advanced
interactions are beyond the scope of this cursory overview, but you’re
definitely encouraged to explore them on your own.</p>

<h1 id="using-jruby-from-java">Using JRuby from Java</h1>

<p>While Java libraries are capable of doing just about anything they are
generally not as elegant as some of their Ruby counterparts. This might
make you want to run some Ruby code from a Java program. JRuby allows
you do this:</p>

<div class="highlight"><pre><code class="java"><span class="kn">import</span> <span class="nn">org.jruby.embed.InvokeFailedException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.jruby.embed.ScriptingContainer</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">RubyFromJava</span> <span class="o">{</span>
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">ScriptingContainer</span> <span class="n">container</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ScriptingContainer</span><span class="o">();</span>
        <span class="n">container</span><span class="o">.</span><span class="na">runScriptlet</span><span class="o">(</span><span class="s">&quot;puts &#39;Ruby bridge established successfully&#39;&quot;</span> <span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>This example is quite basic, but you should be able to grasp the basic
idea from it.</p>

<h1 id="compatibility-with-standard-ruby-and-performance">Compatibility with standard Ruby and performance</h1>

<p>JRuby 1.6 is mostly compatible with MRI Ruby 1.9.2. Since Ruby doesn’t
have a formal standard and is mostly defined in terms of the reference
implementation (although there are some compatibility test suites)
alternative implementations like JRuby are bound to be a step behind
the current reference version from time to time. JRuby, however,
catches up very quickly and has reached a state in popularity and adoption
at which I’m certain that they (the JRuby team) keep an open communication channel with
upstream MRI developers and are capable to add the new features with
very little delay.</p>

<p>In terms of performance JRuby is slightly faster in many tests than
MRI 1.9.2 and with the inclusion of support for dynamic method
dispatching in Java 7 (coming up later this year) the performance will
probably be improved significantly. The only real performance problem
is the JVM startup time. If you’re using JRuby to run very simple
scripts you might be mislead to believe that JRuby’s very slow, when actually the
delay you’re witnessing is caused by the JVM startup (which is not
very fast). Some Ruby features like ObjectSpace don’t perform very
well on the JVM as well, but they are used rarely.</p>

<p>In a sentence - JRuby is quite compatible with the standard MRI Ruby
and one of the fastest Ruby implementations around.</p>

<h1 id="deployment-options-and-future-prospects">Deployment options and future prospects</h1>

<p>With JRuby your number of deployment options vastly improves - now you
can deploy your Ruby applications anywhere where a JVM can be run (and
there are lot such places, believe me about that). With JRuby you can
deploy your Rails applications on the Google App Engine or in a Java
enterprise container such as Glassfish. You can also write mobile
applications for the Android operating system.</p>

<p>JRuby’s development is funded by a very solid company, called
<a href="http://www.engineyard.com/">“Engine Yard”</a> which is famous for its world class Rails hosting
solutions. The company obviously has a lot at stake here and you
shouldn’t be afraid that JRuby might die anytime soon.</p>

<p>IT consulting companies like
<a href="http://www.thoughtworks.com/">ThoughtWorks</a> have used JRuby to deliver both products and customer
applications on far more aggressive schedules than they could
have with more conventional languages</p>

<h1 id="the-tools-of-the-trade">The tools of the trade</h1>

<p>Most Ruby hackers tend to program without the aid of sophisticated
IDEs. Emacs, vim and TextMate are popular choices. Recently
<a href="http://www.sublimetext.com/">SublimeText</a> has been getting a fair share of attention as well. While
it’s fairly easy to write Ruby code in a text editor it’s generally a
nightmare to write Java code in an editor. Some of the most old-school
hardcore developers that I know bowed down before the complexity of
Java and started using Eclipse, NetBeans or IntelliJ to keep their
sanity intact. When you’re working on a project that’s a mixture of Ruby
and Java code it might be a good choice to opt for using some IDE as
well.</p>

<ul>
  <li><a href="http://www.jetbrains.com/idea/">IntelliJ IDEA</a> - The legendary Java IDE comes with a very capable
Ruby plug-in, that integrates well with Rails, the common templating
languages often used with it and most Ruby testing
frameworks. IntelliJ even has a variant for pure Ruby development
called <a href="http://www.jetbrains.com/ruby/">RubyMine</a> which is regarded by many devs as the best Ruby
IDE out there.</li>
  <li><a href="http://wiki.netbeans.org/RubySupport">NetBeans</a> - At some point the core JRuby team were employed by
Sun and at that time great Ruby support was added to
NetBeans. Oracle killed the official Ruby support in NetBeans 7.0,
but it’s still maintained as a community project. It’s not as good
as the one in RubyMine, but it doesn’t cost anything either.</li>
  <li><a href="http://www.eclipse.org/dltk/">Eclipse</a> - Eclipse has an official
Ruby plug-in(part of DLTK), but most people tend to prefer using
<a href="http://www.aptana.com/products/studio3">Aptana Studio</a> - a web
development IDE built on top of Eclipse.</li>
</ul>

<h1 id="epilogue">Epilogue</h1>

<p>JRuby is a solid addition to the ranks of JVM languages. Given the
fact that Ruby served as the principle inspiration for Groovy many
people will probably do better to use JRuby in preference to Groovy
(except the ones fond of the Java syntax I guess). I personally love
both Ruby and the JVM and for me JRuby was a match made in heaven. It
opens a lot new and exciting possibilities before one of the most
beautiful languages ever conceived. </p>

<p>I particularly like the ability to create portable GUIs with Swing and
the extended deployment options that JRuby provides. If Java 7 brings
the promised speed improvements I’m certain that JRuby will have a
shot at becoming the reigning Ruby implementation. </p>

<p>So what are you waiting for? Go grab a copy of the JRuby Bible
<a href="http://pragprog.com/titles/jruby/using-jruby">“Using JRuby”</a> and
start coding. :-)</p>

<div style="font-style: italic; color: #7f9f7f;">Posted on 18 May 2011 by Bozhidar.</div>

<p><a href="/Ruby/Java/2011/05/18/jvm-langs-jruby.html#disqus_thread">Comments</a></p>

<h2 id="recommended-ruby-booksrubybooks20110517recommended-ruby-bookshtml"><a href="/Ruby/Books/2011/05/17/recommended-ruby-books.html">Recommended Ruby books</a></h2>
<h1 id="overture">Overture</h1>

<p>Back in the day when Ruby wasn’t particularly popular outside Japan
there was only one book in English about Ruby -
<a href="http://www.amazon.com/Programming-Ruby-1-9-Pragmatic-Programmers/dp/1934356085/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1305641089&amp;sr=1-1">“Programming Ruby”</a>, affectionately called the Pickaxe by most
Rubyists. Those day are long gone now. Ruby on Rails propelled Ruby
into the mainstream and quite a few books on Ruby (and Rails) have
been published over the past five or so years. With so many books to
choose from developers often find it hard to pick up the <em>right</em> book.</p>

<p>In this post I’ll share with you my thoughts on the Ruby books that I’ve found
to be the most interesting and valuable. Feel free to disagree with
me, after all this is a highly subjective matter.</p>

<h1 id="beginner-books">Beginner books</h1>

<p>Every saga has a beginning, every journey has a first step, every
programming language has a first book…</p>

<p><strong><a href="http://pragprog.com/titles/ltp2/learn-to-program">Learn to Program</a></strong></p>

<p>A book that teaches programming to absolute beginners with Ruby as the
implementation language. I haven’t read this book (only excerpts from
it), but I’ve used it as a gift for several acquaintances of mine, with the
desire to learn to program. All of them were frustrated by other
introductory books they’ve read and all of them praised “Learn to
Program” for its immense clarity, engaging and enjoyable style and
comprehensible examples.</p>

<p><strong><a href="http://www.amazon.com/gp/product/1933988657/ref=s9_simh_gw_p14_d0_i7?pf_rd_m=ATVPDKIKX0DER&amp;pf_rd_s=center-2&amp;pf_rd_r=0Q48PY008200T745JZSF&amp;pf_rd_t=101&amp;pf_rd_p=470938631&amp;pf_rd_i=507846">The Well Grounded Rubyist</a></strong></p>

<p>“The Well Grounded Rubyist” is a thoroughly revised and updated edition
of the older book Ruby for Rails (which was 90% Ruby and 10% Rails). In this new book, author David
A. Black moves beyond Rails and presents a broader view of Ruby. It
covers Ruby 1.9 in great detail, unlike many introductory texts that
tend to offer only superficial coverage of many topics.</p>

<p>Starting with the basics, The Well-Grounded Rubyist explains Ruby
objects and their interactions from the ground up. In the middle
chapters, the book turns to an examination of Ruby’s built-in, core
classes, showing the reader how to manipulate strings, numbers,
arrays, ranges, hashes, sets, and more. Regular expressions get
attention, as do file and other I/O operations. At 500+ pages it’s a
bit of a hefty tome, but it’s definitely worth reading it.</p>

<h1 id="reference-books">Reference books</h1>

<p>Reference books are not usually the biggest fun to read, but they tend
to cover everything a language has to offer and we generally keep them
close. Their value increases with the increase of our knowledge of a
particular language.</p>

<p><strong><a href="http://www.amazon.com/Ruby-Programming-Language-David-Flanagan/dp/0596516177">The Ruby Programming Language</a></strong></p>

<p>Co-authored by Ruby’s creator Matz this is without a doubt the best
analysis of the languages. Everything you need to know is explained in
a crisp and easy to comprehend manner. The thing I liked most about the
book was the depth in which all the topics were discussed - given the
superficial coverage of some topics (such as encodings) in other books,
this book really stands out. The book is full of examples and
artwork by <em>why the lucky stiff</em>, and covers both Ruby 1.8 and 1.9. The
chapters on proc &amp; clojures and metaprogramming were particularly
strong. The books is geared mostly towards experienced programmers who
are new to Ruby. If you’re one of them - it’s unlikely you’ll find a
better starting point in your journey to Ruby mastery.</p>

<p><strong><a href="http://www.amazon.com/Programming-Ruby-1-9-Pragmatic-Programmers/dp/1934356085/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1305636206&amp;sr=1-1">Programming Ruby</a></strong></p>

<p>Co-authored by the Pragmatic Programmers themselves (Dave Thomas &amp;
Andy Hunt) this was the very first English book on Ruby (and arguably
an instrument in Ruby’s international success). The first edition of
the books is freely available on-line, but it’s very outdated so I
wouldn’t recommend you to read it. The book has two parts
- a tutorial part and a reference part. </p>

<p>The tutorial part is very well written and quite readable. It’s geared
towards less experienced developers and you’ll not find as detailed
coverage of the topics as in “The Ruby Programming Language”. You’ll,
however, find full coverage of everything new in Ruby 1.9 - the book includes all the new and changed syntax and
semantics introduced since Ruby 1.8 and information about the new parameter
passing rules, local variable scoping in blocks, fibers,
multinationalization, and the new block declaration syntax.  </p>

<p>The reference part of the book includes a description of all the
standard library modules, a complete reference for all built-in classes
and modules (including all the new and changed methods introduced by
Ruby 1.9). </p>

<p>I’m not sure we need the whole Ruby standard library documentation on
paper anymore in the age of the Internet, but I guess some people will
find it helpful. I just feel that the additional documentation simply
made the book heavier (and possibly pricier).</p>

<h1 id="intermediate-ruby-books">Intermediate Ruby books</h1>

<p>Once you’ve read a reference or a beginner’s Ruby book you might want
to move to some book that illustrates common Ruby style, techniques
and idioms. </p>

<p><strong><a href="http://www.amazon.com/Ruby-Best-Practices-Gregory-Brown/dp/0596523009/ref=sr_1_1?ie=UTF8&amp;qid=1305640369&amp;sr=8-1">Ruby Best Practices</a></strong></p>

<p>“Ruby Best Practices” is aimed at programmers who want to use Ruby as
experienced Rubyists do. Written by the developer of the Ruby project
Prawn, this concise book explains how to design beautiful APIs and
domain-specific languages with Ruby, as well as how to work with
functional programming ideas and techniques that can simplify your
code and make you more productive. You’ll learn how to write code
that’s readable and expressive.</p>

<p>The whole book is currently available from free
<a href="http://blog.rubybestpractices.com/posts/gregory/022-rbp-now-open.html">on-line</a>
and has a very nice companion <a href="http://blog.rubybestpractices.com/">blog</a>.</p>

<p><strong><a href="http://www.amazon.com/Eloquent-Ruby-Addison-Wesley-Professional/dp/0321584104/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1305640620&amp;sr=1-1">Eloquent Ruby</a></strong></p>

<p>The latest (and one of the greatest) Ruby books I’ve read. The book
pretty much has the same aim as “Ruby Best Practices”, but covers a lot
more ground and is generally a lighter and more enjoyable read. Russ
Olsen has a very particular writing style that turns even the most
boring subjects into interesting discussions. All chapters feature
some real world examples of the concepts introduced, and a discussion
of potential pitfalls.</p>

<p>Very highly recommended second Ruby book.</p>

<p><strong><a href="http://www.amazon.com/Design-Patterns-Ruby-Russ-Olsen/dp/0321490452/ref=pd_sim_b_6">Design Patterns in Ruby</a></strong></p>

<p>A most enjoyable rendition of a generally boring subject by Russ Olsen. “Design
Patterns in Ruby” explores 14 of the classical GoF design patterns and
compares the canonical implementation of the patterns to idiomatic
Ruby versions of them. Every pattern features a discussion of common
use cases, pitfalls and real world usages.</p>

<p>The book also builds on top of the original patterns by adding a
couple of new ones like DSL and Convention over configuration.</p>

<p>Without a doubt one of the best Design pattern books and a must read
for all Ruby hackers. You don’t need any previous knowledge of design
patterns prior to reading this book, but there are a lot of references
to the classic GoF text so you might want to read it beforehand.</p>

<h1 id="advanced-ruby-books">Advanced Ruby books</h1>

<p>At some point you might want to explore some of the darker corners of Ruby.</p>

<p><strong><a href="http://www.amazon.com/Metaprogramming-Ruby-Program-Like-Pros/dp/1934356476/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1305641577&amp;sr=1-1">Metaprogramming in Ruby</a></strong></p>

<p>The ability to modify programs at runtime is one the greatest
strengths of Ruby, but it seems to frighten a lot of people (which is
understandable given the constant usage of fancy words like
eigenclass). If you want to sharpen your Ruby metaprogramming skills -
this is the one true book. </p>

<p><strong><a href="http://www.amazon.com/Using-JRuby-Bringing-Ruby-Facets/dp/1934356654/ref=sr_1_1?s=books&amp;ie=UTF8&amp;qid=1305641415&amp;sr=1-1">Using JRuby: Bringing Ruby to Java</a></strong></p>

<p>Believe it or not currently JRuby seems to be best Ruby implementation
around. If you’re interested in using JRuby you’d do well to learn
more about the integration with the JVM that JRuby provides as well as
the various new deployment options that JRuby introduces. </p>

<p>This book was written by the core JRuby developers and it’s absolutely
excellent. Clear and concise writing style, lots of useful examples.</p>

<h1 id="epilogue">Epilogue</h1>

<p>There are certainly other great Ruby books around that I haven’t read,
but I guess that at some point reading books is just not as helpful as
writing real code. I do believe, however, that even experienced
developers can benefit from a good programming book.</p>

<p>So, which Ruby books that I’ve missed would you recommend?</p>

<div style="font-style: italic; color: #7f9f7f;">Posted on 17 May 2011 by Bozhidar.</div>

<p><a href="/Ruby/Books/2011/05/17/recommended-ruby-books.html#disqus_thread">Comments</a></p>

<h2 id="javanext---clojure-the-return-of-the-lispersclojurejava20110512jvm-langs-clojurehtml"><a href="/Clojure/Java/2011/05/12/jvm-langs-clojure.html">Java.next() - Clojure: The Return of the Lispers</a></h2>
<h1 id="overture">Overture</h1>

<p>This is the third part of the series of <strong>Java.next()</strong>. Last time
we’ve discussed the merits of <a href="/Java/Scala/2011/05/08/jvm-langs-scala.html">Scala</a> - an OO language with a strong
emphasis on functional and parallel programming. Today we’ll be
discussing Clojure - a language that pushes the envelop a lot further
than Scala as far as functional and parallel programming are
concerned. You’ll see that Clojure is radically different from Scala
and Groovy in many aspects - it’s not an OO language, it doesn’t have
Algol-derived syntax and it introduces a few rather radical ideas on
subjects such as <a href="http://clojure.org/state">identity and state</a>.</p>

<p>Clojure’s approach to concurrency is characterized by the concept of
identities, which represent a series of immutable states over
time. Since states are immutable values, any number of workers can
operate on them in parallel, and concurrency becomes a question of
managing changes from one state to another. For this purpose, Clojure
provides several mutable reference types, each having well-defined
semantics for the transition between states. This is a pretty complex
topic for a language overview so I’ll discuss it here only cursory.</p>

<p>Clojure was initially conceived as targeting both the JVM and the
CLR. For various reason currently the core development team is targeting mainly
the JVM and the <a href="https://github.com/richhickey/clojure-clr">CLR port</a>
is receiving less attention (though it’s not abandoned and it’s
regularly being updated). Like Scala it’s not technically correct to
call it a JVM languages, because it’s both a JVM and a .Net language,
but since it’s used a lot more often with Java it doesn’t make that
much of a difference.</p>

<h1 id="a-brief-history-of-clojure">A brief history of Clojure</h1>

<p>Clojure is a very young project (compared to most popular
programming languages at least). It was created in 2007 by Rich
Hickey (project leader and benevolent dictator for life). He developed
Clojure because he wanted a modern Lisp for functional programming,
symbiotic with the established Java platform, and designed for
concurrency. What started as a hobby project turned into some much
bigger with Rich getting so excited about the project that left his
job to work full-time on the project, effectively through burning his life’s
savings in the process. This was quite the gamble, but it turned out
to be a lucky one, since Clojure’s popularity rapidly spiked and
loyal and energetic community was quickly formed around the project. </p>

<p>Clojure became the new language of choice for many well respected
hackers from different communities. I’ve noticed something of a trend
in that department - most Clojure hackers used to be Ruby hackers. I
guess some of the Ruby hackers were not satisfied by partial subset of
Lisp features, available in Ruby, and wanted to gain access to all of
Lisp’s power.</p>

<p>The current Clojure version is 1.2 with 1.3 being just around the
corner.</p>

<h1 id="installing-clojure">Installing Clojure</h1>

<p><em>Before installing Clojure make sure you have Java installed. Java 5.0
SE will do, but Java 6 SE is highly recommended.</em></p>

<p>Installing Clojure is just a matter of downloading and extracting a
single archive -
<a href="http://github.com/downloads/clojure/clojure/clojure-1.2.0.zip">clojure.zip</a>. Many
high quality Clojure libraries come prepackaged in another archived
named
<a href="http://github.com/downloads/clojure/clojure-contrib/clojure-contrib-1.2.0.zip">Clojure Contrib</a>. Clojure
Contrib is kind of a staging area for Clojure development - it’s a
common practice to move some of the best parts of contrib into core.</p>

<p>In the directory in which you expanded clojure.zip, run:</p>

<div class="highlight"><pre><code class="console"><span class="gp">$</span> java -cp clojure.jar clojure.main
</code></pre>
</div>

<p>This will bring up a simple read-eval-print loop (REPL) a.k.a. an
interactive console. Much of
Clojure is defined in Clojure itself (in the <strong>core.clj</strong> file included in
the src directory of distribution), which is automatically loaded from
the .jar file when Clojure starts. The file <strong>user.clj</strong>, if found in the
classpath, will be auto-loaded as well. You can leverage this to cause
code to run when Clojure starts. Reading the code in core.clj is a
very good way to get started with language and see how real Clojure
hackers work.</p>

<p>When core.clj is loaded you will have the language as described herein fully available.
Try:</p>

<div class="highlight"><pre><code class="clojure"><span class="nv">user=&gt;</span> <span class="p">(</span><span class="nb">+ </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">6</span>
<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Hello, Clojure!&quot;</span><span class="p">)</span>
<span class="nv">Hello,</span> <span class="nv">Clojure!</span>
<span class="nv">nil</span>
<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">javax</span><span class="o">.</span><span class="nv">swing</span><span class="o">.</span><span class="nv">JOptionPane/showMessageDialog</span> <span class="nv">nil</span> <span class="s">&quot;Hello World&quot;</span><span class="p">)</span>
</code></pre>
</div>

<p>The REPL has very rudimentary editing. For a better experience, try running it via the <a href="http://jline.sourceforge.net/">JLine</a> ConsoleRunner:</p>

<div class="highlight"><pre><code class="console"><span class="go">java -cp jline-0_9_5.jar:clojure.jar jline.ConsoleRunner clojure.main</span>
</code></pre>
</div>

<p>This will give you left/right arrow key navigation and up/down arrow
command history.</p>

<p>Later on we’ll see how to setup a real Clojure development environment
in which you’ll be able to leverage the full power of the Clojure REPL
and interactive programming.</p>

<h1 id="did-you-say-clojure-was-a-lisp">Did you say Clojure was a Lisp???</h1>

<p>Most developers tend to have a very negative attitude towards the word
<strong>Lisp</strong> in general. I guess it spawns all kinds of nasty associations in
their brains - like prefix syntax notation, tons of parentheses and a
lot of crap they heard about Lisp from their 70 year-old professor,
teaching introduction to functional programming in college, whose
notion of functional programming is that in Lisp everything is a
function (believe me when I tell you this - such professors do exist).</p>

<p>You know, I wasn’t born coding in Lisp myself. I was initially
exposed to Lisp when I tried to learn the Emacs text editor and I was
baffled by many things - the strange syntax, the talk about atoms and
lists, code as data, macros, continuation, tail-call optimizations,
what to quote and that to evaluate, what is a s-expression and what
isa form. To put it shortly - I was like
Alice down the rabbit whole or like Neo when he found out what the
Matrix is… The world of programming that I was familiar with was
turned upside down.</p>

<p>The interesting thing is that I felt similarly when I learnt my first
programming language Pascal in the 8th grade. It’s not that Lisp is
any harder than the other programming languages - it’s just that it’s
different and you’re usually approaching it from a position in which
you know one or several programming languages, using the much more
widespread Algol syntax. I advise you to simply keep an open mind while
you read this article and don’t just dismiss Clojure because of its
Lisp heritage.</p>

<p>You likely know at least one person who constantly keeps telling
you how Lisp is the one true programming language, how everything
pales next to it and how Lisp is the actual answer to that fundamental
question about the life, the universe and everything else (not
42). These people might very well be telling the truth, but their
zealous rants tend to create a negative attitude towards the Lisp
community as well. Please, ignore them.</p>

<p>Now it’s time to take the red pill… So fasten your seat-belt
Dorothy, ‘cause Kansas is going bye-bye! </p>

<h1 id="clojure-at-a-glance">Clojure at a glance</h1>

<p><em>Mutable state is the new spaghetti code!</em> - Rich Hickey, creator of Clojure</p>

<p><em>Time is the new memory!</em> - Rich Hickey</p>

<p><em>Clojure feels like a general-purpose language beamed back from the
near future. Its support for functional programming and software
transactional memory is well beyond current practice and is well
suited for multicore hardware. At the same time, Clojure is well
grounded in the past and the present. It brings together Lisp and the
Java Virtual Machine. Lisp brings wisdom spanning most of the history
of programming, and Java brings the robustness, extensive libraries,
and tooling of the dominant platform available today.</em> - Stuart
Halloway, author of
<a href="http://www.pragprog.com/titles/shcloj/programming-clojure">“Programming Clojure”</a></p>

<p>If I had only a few minutes to describe Clojure this would be the gist
of it:</p>

<ul>
  <li>Dynamic language for the JVM
    <ul>
      <li>Clojure uses dynamic typing like languages such Ruby and Python
and a very smart compiler that will generally generate very
efficient bytecode. If you want to push the performance envelope even
further you can add some explicit type hints in your Clojure
code to ensure the generation of even faster bytecode.</li>
    </ul>
  </li>
  <li>Lisp reloaded
    <ul>
      <li>Clojure is Lisp down to its core - it has all the features that
are known and loved, and in the same time it improves upon them in
several ways - for instance we have a literal syntax for most
common collection types. Sure - with Common Lisp’s reader macros
one can do this as well, but nobody bothers to…</li>
    </ul>
  </li>
  <li>Elegant
    <ul>
      <li>Clojure code tends to be very concise, but very readable non the
less. A core idea in Clojure is to strip the incidental
complexity of problems solving and to be able to just solve the
problems straight away without much ceremony.</li>
    </ul>
  </li>
  <li>Functional
    <ul>
      <li>Clojure puts heavy emphasis on functional programming, but it’s
a practical functional programming language - not a pure one
like Haskell. Clojure acknowledges that some stuff simply change
and operations have to generally produce some effects, and makes
those things easy to model. Clojure has a library full of
rock-solid immutable data structures, relies heavily on lazy
evaluation, tail-recursion and higher-order functions.</li>
    </ul>
  </li>
  <li>Designed with concurrency in mind
    <ul>
      <li>Clojure has an extensive built-in high-level facilities to deal
with concurrent access to data and parallel programming in general.</li>
    </ul>
  </li>
  <li>Fast
    <ul>
      <li>Unlike many dynamic languages (even those running on top the
JVM) Clojure is quite fast - it some scenarios it’s performance
can rival that of a statically type language. You can browse a
long list of
<a href="http://stackoverflow.com/questions/2186709/are-there-any-good-clojure-benchmarks">benchmark comparisons</a>
to verify this statement. Given the fact that performance if
often cited as a big drawback of dynamic languages, this is
quite the win for Clojure.</li>
    </ul>
  </li>
  <li>Capable of easily leveraging existing Java code
    <ul>
      <li>Using Java code from Clojure is direct, easy and
idiomatic. There are no intermediate layers or the need to
write wrapper for everything.</li>
    </ul>
  </li>
</ul>

<p>I’ll discuss in greater detail some of those features as I moving along.</p>

<h1 id="a-whirlwind-tour-of-clojure">A whirlwind tour of Clojure</h1>

<p><strong>Clojure is elegant</strong></p>

<ul>
  <li>Removes a lot of accidental complexity</li>
  <li>Clojure programs are generally expressive and concise</li>
  <li>Concise programs are naturally easier to understand and maintain</li>
</ul>

<p>Consider this Java example from our Scala discussion:</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasUpperCase</span><span class="o">(</span><span class="n">String</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">word</span> <span class="o">==</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="kt">int</span> <span class="n">len</span> <span class="o">=</span> <span class="n">word</span><span class="o">.</span><span class="na">length</span><span class="o">();</span>
    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">len</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">Character</span><span class="o">.</span><span class="na">isUpperCase</span><span class="o">(</span><span class="n">word</span><span class="o">.</span><span class="na">charAt</span><span class="o">(</span><span class="n">i</span><span class="o">)))</span> <span class="o">{</span>
            <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>
        <span class="o">}</span>
    <span class="o">}</span>
    <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>As a reader pointed out using the third party Guava library the code
can be reduced to:</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">hasUpperCase</span><span class="o">(</span><span class="n">String</span> <span class="n">word</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="kc">null</span> <span class="o">!=</span> <span class="n">word</span><span class="o">)</span>
        <span class="k">return</span> <span class="nf">any</span><span class="o">(</span><span class="n">charactersOf</span><span class="o">(</span><span class="n">word</span><span class="o">),</span> <span class="k">new</span> <span class="n">Predicate</span><span class="o">()</span> <span class="o">{</span>
                <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">apply</span><span class="o">(</span><span class="n">Character</span> <span class="n">c</span><span class="o">)</span> <span class="o">{</span>
                    <span class="k">return</span> <span class="nf">isUpperCase</span><span class="o">(</span><span class="n">c</span><span class="o">);</span>
                <span class="o">}</span>
            <span class="o">})</span>
        <span class="k">else</span>
            <span class="k">return</span> <span class="kc">false</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
</div>

<p>It still looks quite ugly to me. For the sake of comparison here’s the
Clojure version:</p>

<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="k">defn </span><span class="nv">has-uppercase?</span> <span class="p">[</span><span class="nv">string</span><span class="p">]</span>
  <span class="p">(</span><span class="nb">some </span><span class="o">#</span><span class="p">(</span><span class="nv">Character/isUpperCase</span> <span class="nv">%</span><span class="p">)</span> <span class="nv">string</span><span class="p">))</span>
</code></pre>
</div>

<p>The definition of the problems is “A string has an uppercase character if
some of the characters in it is uppercase” (doesn’t sound good, but
will do). The Clojure code reads more or less like the definition of
the problem. A finer point is that it will work correctly even if you
pass <strong>nil</strong> to the has-uppercase? function.</p>

<p><strong>Clojure is concise</strong></p>

<p>We already saw in the previous example the conciseness of Clojure
code, but here we’ll add another example. This is Java:</p>

<div class="highlight"><pre><code class="java"><span class="kd">class</span> <span class="nc">Person</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>

    <span class="n">Person</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="n">String</span> <span class="nf">getName</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setName</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getAge</span><span class="o">()</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setAge</span><span class="o">(</span><span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

<p>In Clojure you’d probably model this class like this:</p>

<div class="highlight"><pre><code class="clojure"><span class="nv">user&gt;</span> <span class="p">(</span><span class="nf">defrecord</span> <span class="nv">person</span> <span class="p">[</span><span class="nv">name</span> <span class="nv">age</span><span class="p">])</span>
<span class="nv">user</span><span class="o">.</span><span class="nv">person</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nf">person</span><span class="o">.</span> <span class="s">&quot;Bozhidar&quot;</span> <span class="mi">26</span><span class="p">)</span>
<span class="o">#</span><span class="nv">:user</span><span class="o">.</span><span class="nv">person</span><span class="p">{</span><span class="nv">:name</span> <span class="s">&quot;Bozhidar&quot;</span><span class="o">,</span> <span class="nv">:age</span> <span class="mi">26</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="k">def </span><span class="nv">me</span> <span class="p">(</span><span class="nf">person</span><span class="o">.</span> <span class="s">&quot;Bozhidar&quot;</span> <span class="mi">26</span><span class="p">))</span>
<span class="o">#</span><span class="ss">&#39;user/me</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nf">:name</span> <span class="nv">me</span><span class="p">)</span>
<span class="s">&quot;Bozhidar&quot;</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nf">:age</span> <span class="nv">me</span><span class="p">)</span>
<span class="mi">26</span>
</code></pre>
</div>

<p>Clojure’s version of the type is a one liner and remain shorter even
with a few examples of its usage. It’s not equivalent to Java
definition, however - the Clojure version of the structure is
immutable.</p>

<p><strong>Clojure is a Lisp</strong></p>

<p>For better or for worse Clojure is a Lisp dialect and we should accept
this. I have always viewed Lisp as weapon from a more elegant era when
people were more concerned with elements of style and empowering the
developers to easily translate their thoughts into programs. For one
reason or another every Lisp dialect has failed to capture the
attention of a critical mass of developers that may propel it into the
mainstream. This, of course, doesn’t mean that existing Lisp dialects
should be considered a failure. Scheme (the dialect that has probably
had the greatest impact on Clojure’s design) was designed to be as
simple as possible so it could be appropriate as a teaching tool - in
that area Scheme certainly excelled. Common Lisp was created to bring
together the various Lisp dialects under a common denominator and it
also excelled in that endeavour. I guess that its creators hoped that
it would capture a significant market share at some point as well, but alas -
that never happened. </p>

<p>The syntax and programming model of Lisp so far have been too much for
a typical developer to absorb. Yet, there’s something special about
Lisp that’s worth revisiting, so the new dialects continue to
emerge. Some of the best programming universities start teaching
programming with the Lisp language to form young minds while they are
still open. I have witnessed something of a cycle - every 5 or so
years the interest in Lisp spikes because of something major that
happened in the land of Lisp. In the beginning of the nineties the
work on Common Lisp excited a lot of developers. Five years later Paul
Graham took the stage - he showed the world how Lisp can empower small
teams and make real money (if you haven’t heard of Viaweb fire up
google now). Five years ago Peter Seibel published the
“Practical Common Lisp” book that appeared on Amazon’s bestseller list
and got a lot of new developers excited about Lisp. A now… well I
guess you can figure that one out on your own.</p>

<p>Lisp just won’t let go and die. There is something magical about
it. And there is this inexplicable smugness on the face of Lisp
developers…</p>

<p>So let’s review the typical Lisp features that are present in Clojure:</p>

<ul>
  <li>Lisp-1 dialect
    <ul>
      <li>This means that functions and variables share the same
namespace, unlike in dialects like Common Lisp. Both approaches
have their merits and drawbacks as usual. In Clojure you cannot
have a variable named the say way as a function, but you can
pass function names around without any special syntax. In Common
Lisp you can have function and variables sharing the same name,
but you have to mark functions explicitly when you’re passing
them around (with the #’ reader macro or the <strong>function</strong> function).</li>
    </ul>
  </li>
  <li>Dynamic - both in term of dynamic typing and dynamic
development. Lisp is the language that made popular the technique of
incremental interactive development (we’ll talk about it more in a bit)</li>
  <li>Code is data
    <ul>
      <li>List code is defined in term of Lisp data structures. When the
reader read the source code of the application it converts it to
standard Lisp objects and they represent the program. No special
transformations, no AST. This is the heart of Lisp macros and a
centrepiece in Lisp philosophy.</li>
    </ul>
  </li>
  <li>Reader
    <ul>
      <li>The reader can read valid Clojure forms and translate them into
Clojure objects - object, function call, everything that has a
readable representation</li>
    </ul>
  </li>
  <li>Small core, next to none syntax
    <ul>
      <li>In terms of compact syntax and uniformity of the syntax it has
always been hard to beat Lisp. Most programming languages are
full of special syntax constructs, keywords, etc. In lisp
programs are just lists and the low-level plumbing comes in the
form of special functions called special forms. Everything else
is implemented in terms of those special forms. </li>
    </ul>
  </li>
  <li>Sequences
    <ul>
      <li>Clojure abstracts common collection traits into an abstraction
called seq which allows you to use a similar API for many tasks</li>
    </ul>
  </li>
  <li>Macros
    <ul>
      <li>Forget about C macros, Word macros, editor macros. Lisp macros
are the most powerful metaprogramming technique out there - they
enable you generate new syntax abstractions unlike anything
else. If you need a new operator in Java you’d have a hard time
convincing the guys in Oracle to add it for you. With Lisp
you’re in charge and you can define any syntax abstractions that
you wish. As an appetiser consider the <strong>and</strong> boolean
statement. In most languages it’s built into the language
itself. In Clojure it’s just a short macro:</li>
    </ul>
  </li>
</ul>

<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="k">defmacro </span><span class="nv">and</span>
  <span class="s">&quot;Evaluates exprs one at a time, from left to right. If a form</span>
<span class="s">  returns logical false (nil or false), and returns that value and</span>
<span class="s">  doesn&#39;t evaluate any of the other expressions, otherwise it returns</span>
<span class="s">  the value of the last expr. (and) returns true.&quot;</span>
  <span class="p">{</span><span class="nv">:added</span> <span class="s">&quot;1.0&quot;</span><span class="p">}</span>
  <span class="p">([]</span> <span class="nv">true</span><span class="p">)</span>
  <span class="p">([</span><span class="nv">x</span><span class="p">]</span> <span class="nv">x</span><span class="p">)</span>
  <span class="p">([</span><span class="nv">x</span> <span class="nv">&amp;</span> <span class="nv">next</span><span class="p">]</span>
   <span class="o">`</span><span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">and</span><span class="o">#</span> <span class="nv">~x</span><span class="p">]</span>
      <span class="p">(</span><span class="k">if </span><span class="nv">and</span><span class="o">#</span> <span class="p">(</span><span class="nb">and </span><span class="nv">~@next</span><span class="p">)</span> <span class="nv">and</span><span class="o">#</span><span class="p">))))</span>
</code></pre>
</div>

<p>I hope this example gives you an idea about the power that Clojure
offers you - you can be more than just a programmer; you can be the
language designer.</p>

<h1 id="persistent-data-structures">Persistent data structures</h1>

<p>Data structures in Clojure are immutable. Operations executed on them
return a new data structure of the same type instead of modifying the
structure in place. Understandably most people are immediately
concerned about the performance implications of such a technique -
this seems like quite a lot of overhead. They needn’t worry, though.</p>

<p>Data structures in Clojure happen to be persistent as well. A persistent data
structure is a data structure which always preserves the previous
version of itself when it is modified -  such data structures are
effectively immutable, as their operations do not (visibly) update the
structure in-place, but instead always yield a new updated
structure. A persistent data structure is not a data structure
committed to persistent storage, such as a disk; this is a different
and unrelated sense of the word “persistent”.</p>

<p>Persistent data structures save a lot of copying around and improve
greatly the performance. Knowing this should be enough for most
developers, those that are more curious can find a lot of interesting
articles on the subject on-line.</p>

<p>The core data structures in Clojure are:</p>

<ul>
  <li>List</li>
  <li>Set - all the items in it are unique</li>
  <li>Map - also known as associative array and dictionary in other languages</li>
  <li>Vector - also know as one dimensional array</li>
</ul>

<p>Let’s see them in action:</p>

<div class="highlight"><pre><code class="clojure"><span class="c1">;;; Lists</span>
<span class="c1">;; list creation</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">list </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">)</span>
<span class="c1">;; quoted list creation</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="k">def </span><span class="nv">a-list</span> <span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">))</span>
<span class="o">#</span><span class="ss">&#39;user/a-list</span>
<span class="c1">;; find the size of a list</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">count </span><span class="nv">a-list</span><span class="p">)</span>
<span class="mi">10</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">first </span><span class="nv">a-list</span><span class="p">)</span>
<span class="mi">1</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">rest </span><span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">)</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">last </span><span class="nv">a-list</span><span class="p">)</span>
<span class="mi">10</span>
<span class="c1">;; find the elements of the list matching a predicate(boolean function)</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">filter </span><span class="nv">even?</span> <span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2</span> <span class="mi">4</span> <span class="mi">6</span> <span class="mi">8</span> <span class="mi">10</span><span class="p">)</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">filter </span><span class="nv">odd?</span> <span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span> <span class="mi">7</span> <span class="mi">9</span><span class="p">)</span>
<span class="c1">;; map an anonymous(lambda) function to all elements of the list</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">map </span><span class="o">#</span><span class="p">(</span><span class="nv">*</span> <span class="nv">%</span> <span class="mi">2</span><span class="p">)</span> <span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">2</span> <span class="mi">4</span> <span class="mi">6</span> <span class="mi">8</span> <span class="mi">10</span> <span class="mi">12</span> <span class="mi">14</span> <span class="mi">16</span> <span class="mi">18</span> <span class="mi">20</span><span class="p">)</span>
<span class="c1">;; add an element to the beginning of the list</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">cons </span><span class="mi">0</span> <span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1">;; cons in a list specific function, conj is a general purpose one and</span>
<span class="c1">;; works on all collection (but in a different manner)</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">conj </span><span class="nv">a-list</span> <span class="mi">0</span><span class="p">)</span>
<span class="p">(</span><span class="mi">0</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">)</span>
<span class="c1">;; retrieve the first five items in a list</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">take </span><span class="mi">5</span> <span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">)</span>
<span class="c1">;; retrieve all but the first five items in a list</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">drop </span><span class="mi">5</span> <span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">)</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">take-while </span><span class="o">#</span><span class="p">(</span><span class="nv">&lt;</span> <span class="nv">%</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">2</span><span class="p">)</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">drop-while </span><span class="o">#</span><span class="p">(</span><span class="nv">&gt;</span> <span class="nv">%</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">)</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">drop-while </span><span class="o">#</span><span class="p">(</span><span class="nv">&lt;</span> <span class="nv">%</span> <span class="mi">3</span><span class="p">)</span> <span class="nv">a-list</span><span class="p">)</span>
<span class="p">(</span><span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span> <span class="mi">7</span> <span class="mi">8</span> <span class="mi">9</span> <span class="mi">10</span><span class="p">)</span>

<span class="c1">;;; Sets</span>

<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">set </span><span class="o">&#39;</span><span class="p">(</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">))</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="k">def </span><span class="nv">a-set</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">})</span>
<span class="o">#</span><span class="ss">&#39;user/a-set</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">contains? </span><span class="nv">a-set</span> <span class="mi">3</span><span class="p">)</span>
<span class="nv">true</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">contains? </span><span class="nv">a-set</span> <span class="mi">7</span><span class="p">)</span>
<span class="nv">false</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">conj </span><span class="nv">a-set</span> <span class="mi">5</span><span class="p">)</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">conj </span><span class="nv">a-set</span> <span class="mi">6</span><span class="p">)</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">6</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">disj </span><span class="nv">a-set</span> <span class="mi">1</span><span class="p">)</span>
<span class="o">#</span><span class="p">{</span><span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">get </span><span class="nv">a-set</span> <span class="mi">1</span><span class="p">)</span>
<span class="mi">1</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">get </span><span class="nv">a-set</span> <span class="mi">7</span><span class="p">)</span>
<span class="nv">nil</span>
<span class="c1">;; most set functions live in the clojure.set namespace</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nf">use</span> <span class="ss">&#39;clojure</span><span class="o">.</span><span class="nv">set</span><span class="p">)</span>
<span class="nv">nil</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">difference </span><span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">}</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">})</span>
<span class="o">#</span><span class="p">{</span><span class="mi">2</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">intersection </span><span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">}</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">})</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">3</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">union </span><span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span><span class="p">}</span> <span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">})</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">}</span>

<span class="c1">;;; Maps</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">hash-map </span><span class="nv">:Bozhidar</span> <span class="nv">:Batsov</span> <span class="nv">:Bruce</span> <span class="nv">:Wayne</span> <span class="nv">:Selina</span> <span class="nv">:Kyle</span><span class="p">)</span>
<span class="p">{</span><span class="nv">:Selina</span> <span class="nv">:Kyle,</span> <span class="nv">:Bozhidar</span> <span class="nv">:Batsov,</span> <span class="nv">:Bruce</span> <span class="nv">:Wayne</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="k">def </span><span class="nv">a-map</span> <span class="p">{</span><span class="nv">:Bozhidar</span> <span class="nv">:Batsov,</span> <span class="nv">:Bruce</span> <span class="nv">:Wayne,</span> <span class="nv">:Selina</span> <span class="nv">:Kyle</span><span class="p">})</span>
<span class="o">#</span><span class="ss">&#39;user/a-map</span>
<span class="nv">user&gt;</span> <span class="nv">a-map</span>
<span class="p">{</span><span class="nv">:Bozhidar</span> <span class="nv">:Batsov,</span> <span class="nv">:Bruce</span> <span class="nv">:Wayne,</span> <span class="nv">:Selina</span> <span class="nv">:Kyle</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">get </span><span class="nv">a-map</span> <span class="nv">:Bozhidar</span><span class="p">)</span>
<span class="nv">:Batsov</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">contains? </span><span class="nv">a-map</span> <span class="nv">:Bozhidar</span><span class="p">)</span>
<span class="nv">true</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">contains? </span><span class="nv">a-map</span> <span class="nv">:Clark</span><span class="p">)</span>
<span class="nv">false</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nf">:Bozhidar</span> <span class="nv">a-map</span><span class="p">)</span>
<span class="nv">:Batsov</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">assoc </span><span class="nv">a-map</span> <span class="nv">:Lois</span> <span class="nv">:Lane</span><span class="p">)</span>
<span class="p">{</span><span class="nv">:Lois</span> <span class="nv">:Lane,</span> <span class="nv">:Bozhidar</span> <span class="nv">:Batsov,</span> <span class="nv">:Bruce</span> <span class="nv">:Wayne,</span> <span class="nv">:Selina</span> <span class="nv">:Kyle</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">keys </span><span class="nv">a-map</span><span class="p">)</span>
<span class="p">(</span><span class="nf">:Bozhidar</span> <span class="nv">:Bruce</span> <span class="nv">:Selina</span><span class="p">)</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">vals </span><span class="nv">a-map</span><span class="p">)</span>
<span class="p">(</span><span class="nf">:Batsov</span> <span class="nv">:Wayne</span> <span class="nv">:Kyle</span><span class="p">)</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">dissoc </span><span class="nv">a-map</span> <span class="nv">:Bruce</span><span class="p">)</span>
<span class="p">{</span><span class="nv">:Bozhidar</span> <span class="nv">:Batsov,</span> <span class="nv">:Selina</span> <span class="nv">:Kyle</span><span class="p">}</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">merge </span><span class="nv">a-map</span> <span class="p">{</span><span class="nv">:Alia</span> <span class="nv">:Atreides,</span> <span class="nv">:Arya</span> <span class="nv">:Stark</span><span class="p">})</span>
<span class="p">{</span><span class="nv">:Arya</span> <span class="nv">:Stark,</span> <span class="nv">:Alia</span> <span class="nv">:Atreides,</span> <span class="nv">:Bozhidar</span> <span class="nv">:Batsov,</span> <span class="nv">:Bruce</span> <span class="nv">:Wayne,</span> <span class="nv">:Selina</span> <span class="nv">:Kyle</span><span class="p">}</span>

<span class="c1">;;; Vectors</span>

<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">vector </span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">]</span>
<span class="nv">user&gt;</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">]</span>
<span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">]</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="k">def </span><span class="nv">a-vector</span> <span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span><span class="p">])</span>
<span class="o">#</span><span class="ss">&#39;user/a-vector</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">count </span><span class="nv">a-vector</span><span class="p">)</span>
<span class="mi">5</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">conj </span><span class="nv">a-vector</span> <span class="mi">13</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span> <span class="mi">5</span> <span class="mi">13</span><span class="p">]</span>
<span class="c1">;; random access is a constant time operation in vectors</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">nth </span><span class="nv">a-vector</span> <span class="mi">3</span><span class="p">)</span>
<span class="mi">4</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">pop </span><span class="nv">a-vector</span><span class="p">)</span>
<span class="p">[</span><span class="mi">1</span> <span class="mi">2</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">]</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">peek </span><span class="nv">a-vector</span><span class="p">)</span>
<span class="mi">5</span>
</code></pre>
</div>

<p>Most data structures in Clojure are part of a common Sequence API,
that we’ll briefly discuss shortly.</p>

<h1 id="the-seq-api">The Seq API</h1>

<p>Clojure defines many algorithms in terms of sequences (seqs). A seq is
a logical list, and unlike most Lisps where the list is represented by
a concrete, 2-slot structure, Clojure uses the ISeq interface to allow
many data structures to provide access to their elements as
sequences. The <strong>seq</strong> function yields an implementation of ISeq
appropriate to the collection. Seqs differ from iterators in that they
are persistent and immutable, not stateful cursors into a
collection. As such, they are useful for much more than foreach -
functions can consume and produce seqs, they are thread safe, they can
share structure, etc.</p>

<p>Most of the sequence library functions are lazy, i.e. functions that
return seqs do so incrementally, as they are consumed, and thus
consume any seq arguments incrementally as well. Functions returning
lazy seqs can be implemented using the <strong>lazy-seq</strong> macro. The laziness
allows us to deal with infinite data structures easily (as long as we
don’t try to act on all of their elements that is):</p>

<div class="highlight"><pre><code class="clojure"><span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">take </span><span class="mi">10</span> <span class="p">(</span><span class="nb">filter </span><span class="nv">even?</span> <span class="p">(</span><span class="nb">iterate </span><span class="nv">inc</span> <span class="mi">1</span><span class="p">)))</span>
<span class="p">(</span><span class="mi">2</span> <span class="mi">4</span> <span class="mi">6</span> <span class="mi">8</span> <span class="mi">10</span> <span class="mi">12</span> <span class="mi">14</span> <span class="mi">16</span> <span class="mi">18</span> <span class="mi">20</span><span class="p">)</span>
</code></pre>
</div>

<p><strong>iterate</strong> returns an infinite lazy sequence. <strong>filter</strong> returns a lazy
sequence as well. With <strong>take</strong> we can take only the elements we need
without have to process the entire infinite collection.</p>

<h1 id="functional-programing-with-clojure">Functional programing with Clojure</h1>

<p>Clojure is a functional programming language and as such it offers quite
the selection of features that make it easy to leverage the functional
programming techniques. </p>

<ul>
  <li>functions are objects</li>
  <li>all built-in data structures are immutable</li>
  <li>most functions in the core library are pure (they don’t produce any
side results and they don’t interact with the outside world in any
manner other than just receiving their parameters from it)</li>
  <li>there are no iteration constructs like <strong>for</strong> and <strong>while</strong> in
other languages. In place of iteration list comprehensions and
recursion are commonly used.</li>
  <li>everything is an expression that yields some result - even things
that are traditionally statements in other languages such as <strong>if</strong> and
<strong>print</strong> (although the return value of print is not particularly useful)</li>
</ul>

<h1 id="parallel-programming">Parallel programming</h1>

<p>Functional programming and parallel programming complement each
other. When most of your code is contained in pure functions it’s
naturally tread safe (not to mention much easier to test). Since you
don’t have any mutable state there, it’s absolutely safe to fire those
pure functions in as many threads as you wish and you’ll have
absolutely nothing to worry about.</p>

<p>Programs, however, eventually produce side effects and often they
really have to have some mutable state. Clojure makes it easy to model
such situations in your programs in a way that doesn’t compromise the
ability to parallelize the programs. </p>

<p><strong>Refs and transactions</strong></p>

<p>Transactional references (known as refs in Clojure) ensure safe shared use of mutable
storage locations via a software transactional memory (STM)
system. Refs are bound to a single storage location for their
lifetime, and only allow mutation of that location to occur within a
transaction.</p>

<p>Clojure transactions should be easy to understand if you’ve ever used
database transactions - they ensure that all actions on refs are
atomic, consistent, and isolated. Atomic means that every change to
refs made within a transaction occurs or none do. Consistent means
that each new value can be checked with a validator function before
allowing the transaction to commit. Isolated means that no transaction
sees the effects of any other transaction while it is running. Another
feature common to STMs is that, should a transaction have a conflict
while running, it is automatically retried.</p>

<p>There are many ways to do STMs (locking/pessimistic,
lock-free/optimistic and hybrids) and it is still a research
problem. The Clojure STM uses multiversion concurrency control with
adaptive history queues for snapshot isolation, and provides a
distinct commute operation. Here’s a short example:</p>

<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">picked-numbers</span> <span class="p">(</span><span class="nb">ref </span><span class="o">#</span><span class="p">{})</span>

<span class="p">(</span><span class="k">def </span><span class="nv">secret-num</span> <span class="p">(</span><span class="o">.</span><span class="nv">nextInt</span> <span class="p">(</span><span class="nf">java</span><span class="o">.</span><span class="nv">util</span><span class="o">.</span><span class="nv">Random</span><span class="o">.</span><span class="p">)</span> <span class="mi">10</span><span class="p">))</span>

<span class="p">(</span><span class="k">defn </span><span class="nv">guess-number</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
        <span class="p">(</span><span class="nb">print </span><span class="s">&quot;Enter a guess between 1 and 10: &quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">flush</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">guess</span> <span class="p">(</span><span class="nf">java</span><span class="o">.</span><span class="nv">lang</span><span class="o">.</span><span class="nv">Integer/parseInt</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">))</span> <span class="p">]</span>
             <span class="p">(</span><span class="nf">cond</span>
               <span class="p">(</span><span class="nb">= </span><span class="nv">guess</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;You guessed correctly&quot;</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">contains? </span><span class="p">(</span><span class="nb">deref </span><span class="nv">picked-numbers</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Pick another number! You already tried that one.&quot;</span><span class="p">)</span>
               <span class="nv">:else</span> <span class="p">(</span><span class="nf">dosync</span>
                      <span class="p">(</span><span class="nb">alter </span><span class="nv">picked-numbers</span> <span class="nv">conj</span> <span class="nv">guess</span><span class="p">)))))</span>

<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">guess-number</span> <span class="nv">secret-num</span><span class="p">)</span>
<span class="nv">Enter</span> <span class="nv">a</span> <span class="nv">guess</span> <span class="nv">between</span> <span class="mi">1</span> <span class="nv">and</span> <span class="mi">10</span><span class="nv">:</span> <span class="mi">1</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">guess-number</span> <span class="nv">secret-num</span><span class="p">)</span>
<span class="nv">Enter</span> <span class="nv">a</span> <span class="nv">guess</span> <span class="nv">between</span> <span class="mi">1</span> <span class="nv">and</span> <span class="mi">10</span><span class="nv">:</span> <span class="mi">3</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">3</span><span class="p">}</span>
<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">guess-number</span> <span class="nv">secret-num</span><span class="p">)</span>    
<span class="nv">Enter</span> <span class="nv">a</span> <span class="nv">guess</span> <span class="nv">between</span> <span class="mi">1</span> <span class="nv">and</span> <span class="mi">10</span><span class="nv">:</span> <span class="mi">5</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">}</span>
</code></pre>
</div>

<p>I hope you got the basic idea from this simple, but mostly useless
snippet. Generally when we have only one object that we’ll be changing
in this manner an atom is a more appropriate choice as we’ll see shortly.</p>

<p><strong>Agents</strong></p>

<p>Like <em>refs</em>, <em>agents</em> provide shared access to mutable state. Where refs
support coordinated, synchronous change of multiple locations, agents
provide independent, asynchronous change of individual
locations (to put it into simpler term you’d use refs if you had to
updated several things and wait for the update to happen and agents if
you need to update only one thing and don’t really care when the
update will happen - only that it will happen). Agents are bound to a single storage location for their
lifetime, and only allow mutation of that location (to a new state) to
occur as a result of an action. Actions are functions (with,
optionally, additional arguments) that are asynchronously applied to
an agent’s state and whose return value becomes the agent’s new
state. Let’s see an agent (Smith maybe?) in action:</p>

<div class="highlight"><pre><code class="clojure"><span class="nv">user&gt;</span> <span class="p">(</span><span class="k">def </span><span class="nv">some-agent</span> <span class="p">(</span><span class="nb">agent </span><span class="mi">0</span><span class="p">))</span>
<span class="o">#</span><span class="ss">&#39;user/some-agent</span>
<span class="nv">user&gt;</span> <span class="p">(</span><span class="nb">dotimes </span><span class="p">[</span><span class="nv">i</span> <span class="mi">100</span><span class="p">]</span>
               <span class="p">(</span><span class="nb">send </span><span class="nv">some-agent</span> <span class="nv">inc</span><span class="p">))</span>
<span class="nv">nil</span>
<span class="nv">user&gt;</span> <span class="nv">some-agent</span>
<span class="o">#</span><span class="nv">&lt;Agent@15c024c:</span> <span class="mi">100</span><span class="nv">&gt;</span>
<span class="nv">user&gt;</span> <span class="nv">@some-agent</span>
<span class="mi">100</span>
</code></pre>
</div>

<p><strong>Atoms</strong></p>

<p>Atoms provide a way to manage shared, synchronous, independent
state. They are a reference type like refs and vars. You create an
atom with atom, and can access its state with deref (or @). Let’s
rework the refs example to use an atom:</p>

<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="k">def </span><span class="nv">picked-numbers</span> <span class="p">(</span><span class="nf">atom</span> <span class="o">#</span><span class="p">{})</span>

<span class="p">(</span><span class="k">def </span><span class="nv">secret-num</span> <span class="p">(</span><span class="o">.</span><span class="nv">nextInt</span> <span class="p">(</span><span class="nf">java</span><span class="o">.</span><span class="nv">util</span><span class="o">.</span><span class="nv">Random</span><span class="o">.</span><span class="p">)</span> <span class="mi">10</span><span class="p">))</span>

<span class="p">(</span><span class="k">defn </span><span class="nv">guess-number</span> <span class="p">[</span><span class="nv">n</span><span class="p">]</span>
        <span class="p">(</span><span class="nb">print </span><span class="s">&quot;Enter a guess between 1 and 10: &quot;</span><span class="p">)</span>
        <span class="p">(</span><span class="nf">flush</span><span class="p">)</span>
        <span class="p">(</span><span class="k">let </span><span class="p">[</span><span class="nv">guess</span> <span class="p">(</span><span class="nf">java</span><span class="o">.</span><span class="nv">lang</span><span class="o">.</span><span class="nv">Integer/parseInt</span> <span class="p">(</span><span class="nf">read-line</span><span class="p">))</span> <span class="p">]</span>
             <span class="p">(</span><span class="nf">cond</span>
               <span class="p">(</span><span class="nb">= </span><span class="nv">guess</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;You guessed correctly&quot;</span><span class="p">)</span>
               <span class="p">(</span><span class="nb">contains? </span><span class="p">(</span><span class="nb">deref </span><span class="nv">picked-numbers</span><span class="p">)</span> <span class="nv">n</span><span class="p">)</span> <span class="p">(</span><span class="nb">println </span><span class="s">&quot;Pick another number! You already tried that one.&quot;</span><span class="p">)</span>
               <span class="nv">:else</span> <span class="p">(</span><span class="nf">swap!</span> <span class="nv">picked-numbers</span> <span class="nv">conj</span> <span class="nv">guess</span><span class="p">))))</span>

<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">guess-number</span> <span class="nv">secret-num</span><span class="p">)</span>
<span class="nv">Enter</span> <span class="nv">a</span> <span class="nv">guess</span> <span class="nv">between</span> <span class="mi">1</span> <span class="nv">and</span> <span class="mi">10</span><span class="nv">:</span> <span class="mi">1</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span><span class="p">}</span>
<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">guess-number</span> <span class="nv">secret-num</span><span class="p">)</span>
<span class="nv">Enter</span> <span class="nv">a</span> <span class="nv">guess</span> <span class="nv">between</span> <span class="mi">1</span> <span class="nv">and</span> <span class="mi">10</span><span class="nv">:</span> <span class="mi">3</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">3</span><span class="p">}</span>
<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">guess-number</span> <span class="nv">secret-num</span><span class="p">)</span>    
<span class="nv">Enter</span> <span class="nv">a</span> <span class="nv">guess</span> <span class="nv">between</span> <span class="mi">1</span> <span class="nv">and</span> <span class="mi">10</span><span class="nv">:</span> <span class="mi">5</span>
<span class="o">#</span><span class="p">{</span><span class="mi">1</span> <span class="mi">3</span> <span class="mi">5</span><span class="p">}</span>
</code></pre>
</div>

<p><strong>Vars</strong></p>

<p>Bindings created with the <strong>binding</strong> macro cannot be seen by any other
thread. Bindings created with binding can be assigned to, which
provides a means for a nested context to communicate with code before
it on the call stack.</p>

<p>I’ll not be discussing them further, because Vars are a vast subject
deserving its own post.</p>

<h1 id="oop-lisp-style">OOP, Lisp style</h1>

<p>Object oriented programming in most programming languages is based on
a single dispatch message passing. The object on which we invoke a
method (poor choice of words, but easier to comprehend) is the
receiver, the method name and it’s arguments are the message. The
method’s invoked solely on the base of the type of the receiver
object.</p>

<p>Lisps have traditionally implemented OOP with generic methods, that
don’t have a receiver and are dispatched on the basis of the types of
all of their arguments. In the world of multiple dispatch the more
traditional single dispatch is just a special case in which only the
type of the first method argument matters. Here’s a taste of
multimethods in Clojure:</p>

<div class="highlight"><pre><code class="clojure"><span class="p">(</span><span class="k">defmulti </span><span class="nv">my-add</span> <span class="p">(</span><span class="k">fn </span><span class="p">[</span><span class="nv">x</span> <span class="nv">y</span><span class="p">]</span> <span class="p">(</span><span class="nb">and </span><span class="p">(</span><span class="nb">string? </span><span class="nv">x</span><span class="p">)</span> <span class="p">(</span><span class="nb">string? </span><span class="nv">y</span><span class="p">))))</span>

<span class="p">(</span><span class="k">defmethod </span><span class="nv">my-add</span> <span class="nv">true</span> <span class="p">[</span><span class="nv">x</span> <span class="nv">y</span><span class="p">]</span>
    <span class="p">(</span><span class="nb">str </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>

<span class="p">(</span><span class="k">defmethod </span><span class="nv">my-add</span> <span class="nv">false</span> <span class="p">[</span><span class="nv">x</span> <span class="nv">y</span><span class="p">]</span>
    <span class="p">(</span><span class="nb">+ </span><span class="nv">x</span> <span class="nv">y</span><span class="p">))</span>

<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">my-add</span> <span class="mi">3</span> <span class="mi">4</span><span class="p">)</span> <span class="c1">; =&gt; 7</span>
<span class="nv">user=&gt;</span> <span class="p">(</span><span class="nf">my-add</span> <span class="s">&quot;3&quot;</span> <span class="s">&quot;4&quot;</span><span class="p">)</span> <span class="c1">; =&gt; &quot;34&quot;</span>
</code></pre>
</div>

<p>Here we defined a multi-method that behaves differently for string and
numeric arguments - strings args are concatenated and numeric args are
added together.</p>

<h1 id="interactive-development">Interactive development</h1>

<p>Traditional programming languages have more or less the following work
flow:</p>

<ul>
  <li>write the unit tests (power to TDD)</li>
  <li>write the source file</li>
  <li>compile the source file (if needed)</li>
  <li>run the source file with an interpreter or run the binary file that
resulted from the compilation step</li>
  <li>if you need to modify something you edit the code and repeat the
other steps</li>
</ul>

<p>Those programs naturally have some entry points. Alternative you can
simple use the test suite you’ve initially developed.</p>

<p>A Lisp developers generally has a very different work flow:</p>

<ul>
  <li>start a REPL</li>
  <li>write some unit tests</li>
  <li>write a few functions definitions in a source file</li>
  <li>compile them interactively and load them in a REPL</li>
  <li>test these functions directly from the REPL</li>
  <li>if you need to modify a function - just edit it and reload in the
REPL</li>
</ul>

<p>I’ve been a C/C++ and Java developer for a long time and I didn’t see
anything wrong with first model. In fact - I had been practising it
for so very long that it felt quite natural to me. After I’ve started
hacking with Lisp, however, my old work flow started to feel very
unproductive to me (especially with statically typed languages). Here
are some key aspects of the interactive (and iterative) development
that is so common in Lisp (not only in Common Lisp ;-) ):</p>

<ul>
  <li>The REPL is an integral process of the coding process. Ruby and
Python developers generally tend to use it only for exploratory
programming although many of the techniques common for Lisp could be
applied for Ruby and Python as well. </li>
  <li>Functions can be defined (and redefined) in real time</li>
  <li>Loading &amp; compilation of code at runtime</li>
  <li>Powerful introspection features</li>
  <li>Interactive development</li>
  <li>Iterative development - you know the old saying “Lather, rinse,
repeat…” (probably one of the oldest examples of recursion).</li>
</ul>

<h1 id="the-tools-of-the-trade">The tools of the trade</h1>

<p>The single biggest problem with Clojure in the moment (at least in my
opinion) has nothing to do with the language itself. The problem is
the lack of decent tooling and infrastructure around it. Lisp hackers
have traditionally favoured the SLIME development environment for
Emacs. Unfortunately the maintainers are not especially interested in
having Clojure support (since SLIME targets Common Lisp) and nobody in
Clojure community seems to be capable of writing an adequate swank
component for Clojure that can be used with an up-to-date version of
SLIME. The existing one is quite rudimentary and doesn’t work with
stock SLIME distributions. But this is not the worst part - the worst
part is that even this crippled SLIME is still the best development
tool for Clojure. IntelliJ’s plug-in is almost unusable, Eclipse’s is
barely usable and NetBeans’s cannot be installed half the time…</p>

<ul>
  <li>IDEs
    <ul>
      <li><a href="http://plugins.intellij.net/plugin/?id=4050">IntelliJ IDEA</a> -
everyone knows how much I love IntelliJ IDEA. Sadly I cannot say
a good word about the La Clojure plug-in. Its mostly unmaintained
(and often broken), has pretty limited features and is generally
good for… nothing. It’s sad to see it’s so far back in
JetBrains’s priority list - they are doing wonderful things in
their Groovy and Scala plugins. </li>
      <li><a href="http://code.google.com/p/counterclockwise/">Eclipse</a> - Eclipse
certainly boasts the best IDE Clojure plug-in at the moment (Counter
clock-wise). It has a lot of features found otherwise only in
SLIME. It even features partial paredit support. Being the best
in such a sorry bunch is not quite an achievement, but at least
the guys there are trying really hard and I’m sure that within one
or two releases they’ll have a great product. </li>
      <li><a href="http://www.enclojure.org/">NetBeans</a> - The Enclojure plug-in
seems to be abandoned currently. It has no released a new version
in over an year and the old one were buggy as hell (when they the
decency to get themselves installed, that is).</li>
      <li><a href="https://github.com/technomancy/swank-clojure">SLIME</a> - The Ultimate Clojure programming environment. Even though
it’s lacking a few features of the Common Lisp counterpart, SLIME
still is the best option for Clojure development, uniquely
attuned to the Lisp philosophy of interactive and incremental development.</li>
    </ul>
  </li>
</ul>

<p>Luckily there’s no lack of good build tools that one can use with Clojure.</p>

<ul>
  <li>Build tools
    <ul>
      <li><a href="http://maven.Apache.org">Apache Maven</a> - Maven has a nice
Clojure plugin</li>
      <li><a href="https://github.com/technomancy/leiningen">Leiningen</a> - probably
the most popular Clojure-specific build tool</li>
      <li><a href="https://github.com/ninjudd/cake">Cake</a> - a solid alternative to Leiningen</li>
      <li><a href="http://www.gradle.org/">Gradle</a> - a build system for Java-based
applications, written in Groovy, that supports Clojure</li>
      <li><a href="http://buildr.apache.org/">Apache Builder</a> - a build system for
Java-based applications, written in Ruby , that supports Clojure</li>
    </ul>
  </li>
</ul>

<h1 id="resources">Resources</h1>

<ul>
  <li>Books
    <ul>
      <li><a href="http://pragprog.com/titles/shcloj/programming-clojure">“Programming Clojure”</a></li>
      <li><a href="http://www.apress.com/9781430272311">“Practical Clojure”</a></li>
      <li><a href="http://joyofclojure.com/">“The Joy of Clojure”</a></li>
    </ul>
  </li>
  <li>Screencasts &amp; Video lectures
    <ul>
      <li><a href="http://clojure.blip.tv/">“Clojure’s channel”</a></li>
    </ul>
  </li>
  <li>Websites &amp; Blogs
    <ul>
      <li><a href="http://blog.fogus.me/">Official website</a></li>
      <li><a href="http://disclojure.org/">Disclojure</a> - a clojure news aggregator</li>
    </ul>
  </li>
  <li>Exercises
    <ul>
      <li><a href="/Misc/Common%20Lisp/2011/05/04/lisp-problems.html">Lisp problems</a> - a work in progress, I’ll add Clojure
solutions next to the Common Lisp ones when I have some thime</li>
      <li><a href="http://foognostic.net/labrepl-summary/">Labrepl</a></li>
      <li><a href="http://projecteuler.net/">Project Euler</a></li>
      <li><a href="https://github.com/functional-koans/clojure-koans">Clojure Koans</a></li>
    </ul>
  </li>
</ul>

<h1 id="epilogue">Epilogue</h1>

<p>Clojure is a radical departure from both traditional Algol-derived
languages and existing Lisp dialects. Its advanced support for
functional programming, combined with a state of the art concurrency
support make it attractive language for the development of heavy duty
enterprise grade systems. Coupled with the seamless Java integration
the sky seems to be the limit for Clojure…</p>

<p>Unfortunately Clojure has to face several problems if it’s to
succeed. First of all it has to attract a critical mass of developers
that are not afraid of the syntactic difference with common
languages. Then there is the concept of functional thinking - a way of
thinking quite foreign to most developers. To be able to properly
leverage the full power of Clojure developers have to be ready to
overcome a steep learning curve, but rest assured, the prize at the
end of the journey is well worth it.</p>

<p>Another gripe with Clojure at this point is the lack of decent
tooling. Sure, we have the <em>supported</em> SLIME, available in ELPA, but
even Emacs users are not particularly happy with it. And let’s face
reality - it’s quite unlikely that many developers will be willing to
give up the comfort of their beloved IDEs just to be able to code in
Clojure. Eclipse, IntelliJ &amp; NetBeans are unfortunately nowhere near
providing a good Clojure experience. Hopefully, this will change
soon…</p>

<p>I’m a very big fan of Lisp in general, that is no secret. I’ve tried
to be as objective as possible and abstained myself from over
extolling some of Clojure’s virtues. I’d like to say, however, that
I’m very excited that we finally have a Lisp dialect that is modern,
simple, powerful, elegant and most of all - capable of getting the job
done. I really hope that Clojure will be instrument of Lisp return on
the centre stage of programming, where it deserves to be.</p>

<p>As usual the article is very shallow overview and doesn’t even
mention some important features of the language. Be sure to check out
some of the resources mentioned.</p>

<p><em>P.S. This is the last of the articles that I’d originally intended to
write. I’m considering the possibility to write a couple of more
chapter of the Java.next() series if people are interested to read
them. JRuby will probably make an appearance, but I’d like to hear
some reader input as well. So, what JVM language do you think is
worthy enough to make an appearance in the Java.next() series?</em></p>

<div style="font-style: italic; color: #7f9f7f;">Posted on 12 May 2011 by Bozhidar.</div>

<p><a href="/Clojure/Java/2011/05/12/jvm-langs-clojure.html#disqus_thread">Comments</a></p>

<h2 id="a-new-zenburn-theme-for-emacsemacs20110511zenburn-emacshtml"><a href="/Emacs/2011/05/11/zenburn-emacs.html">A new Zenburn theme for Emacs</a></h2>
<p><a href="http://slinky.imukuppi.org/zenburnpage/">Zenburn</a> is a popular colour theme for
vim, developed by Jani Nurminen. It’s my personal
belief (and probably that of many of its users I presume) that it’s one of the
best low contrast themes out there and that Zenburn is exceptionally
easy on the eyes. Btw, I love Zenburn so much that I’ve even created a
<a href="https://github.com/bbatsov/blog/blob/master/css/syntax.css">Zenburn theme for Jekyll</a> to be able to use for my blog.</p>

<p>The project was originally
<a href="https://github.com/dbrock/zenburn-el">ported to Emacs</a> by Daniel
Brockman, but it seems that he has lost interest in it recently - very
few updates has been published by him in the past few years. This is
the reason why I gathered all improvements that I could find laying
around the Internet and applied them to the last official Zenburn
version, effectively starting
a <a href="https://github.com/bbatsov/zenburn-emacs/blob/master/zenburn-legacy.el">fork of the project</a>. So far, so good…</p>

<p>Daniel’s version of Zenburn, however, had reached a state in which it took me
too much to make improvements to it - since a lot of users had direct access
to modify it everything in it was in complete disarray - it’s full of
uses of colours that were not defined by the original zenburn,
questionable coding practices and inconsistent theming of
faces. Yesterday I decided to take a closer look at the code of the
theme and clean it up a little - 20 minutes later I was writing <a href="https://github.com/bbatsov/zenburn-emacs/blob/master/zenburn.el">a new
zenburn theme from scratch</a>. I decided that making everything from
the start will probably be less effort anyways. </p>

<p>I’ve added enough faces in the new theme to make it usable for most
users and I’ll (hopefully) continue to improve the theme and expand
the supported modes constantly. If you’re interested - give it a try!
If you’re unhappy with something - create an issue in GitHub (or even
better send me a pull request with your suggested improvements).</p>

<p>It’s my desire to make the new <a href="https://github.com/bbatsov/zenburn-emacs">Zenburn for Emacs</a> just as good as the original.</p>

<div style="font-style: italic; color: #7f9f7f;">Posted on 11 May 2011 by Bozhidar.</div>

<p><a href="/Emacs/2011/05/11/zenburn-emacs.html#disqus_thread">Comments</a></p>


                    </div>
                </div>
                <div id="footer">
                    Copyright &copy; 2010-2011 <a href="mailto:bozhidar.batsov@gmail.com">Bozhidar Batsov</a>. All Rights Reserved.
                    <br/>
                    Powered by <a href="http://jekyllrb.com/">Jekyll</a>.
                </div>
            </div>
            <div id="sidebar">
                <div id="twitter">
                    <script src="http://widgets.twimg.com/j/2/widget.js" type="text/javascript"></script>
                    <script type="text/javascript">
                        new TWTR.Widget({
                        version: 2,
                        type: 'profile',
                        rpp: 4,
                        interval: 6000,
                        width: 250,
                        height: 300,
                        theme: {
                        shell: {
                        background: '#333333',
                        color: '#ffffff'
                        },
                        tweets: {
                        background: '#000000',
                        color: '#ffffff',
                        links: '#4aed05'
                        }
                        },
                        features: {
                        scrollbar: false,
                        loop: false,
                        live: false,
                        hashtags: true,
                        timestamp: true,
                        avatars: false,
                        behavior: 'all'
                        }
                        }).render().setUser('bbatsov').start();
                    </script>
                </div>
                <div id="latest">
                    <div class="sidebar_heading">Latest posts:</div>
                    <ul>
                        
                        <li><a href="/Linux/Fedora/2011/05/31/fedora-15-tips.html">Fedora 15 post installation setup & tips</a></li>
                        
                        <li><a href="/Ruby/Java/2011/05/18/jvm-langs-jruby.html">Java.next() - JRuby: The Rubyists Strike Back</a></li>
                        
                        <li><a href="/Ruby/Books/2011/05/17/recommended-ruby-books.html">Recommended Ruby books</a></li>
                        
                        <li><a href="/Clojure/Java/2011/05/12/jvm-langs-clojure.html">Java.next() - Clojure: The Return of the Lispers</a></li>
                        
                        <li><a href="/Emacs/2011/05/11/zenburn-emacs.html">A new Zenburn theme for Emacs</a></li>
                        
                    </ul>
                </div>
                <div id="tags">
                    <div class="sidebar_heading">Categories:</div>
                    <ul>
                        
                        
                        <li><a href="/categories/Misc/index.html">Misc(6)</a></li>
                        
                        
                        <li><a href="/categories/Hardware/index.html">Hardware(3)</a></li>
                        
                        
                        <li><a href="/categories/Ruby/index.html">Ruby(5)</a></li>
                        
                        
                        <li><a href="/categories/Emacs/index.html">Emacs(6)</a></li>
                        
                        
                        <li><a href="/categories/Rails/index.html">Rails(1)</a></li>
                        
                        
                        <li><a href="/categories/Z Shell/index.html">Z Shell(3)</a></li>
                        
                        
                        <li><a href="/categories/Linux/index.html">Linux(7)</a></li>
                        
                        
                        <li><a href="/categories/Java/index.html">Java(12)</a></li>
                        
                        
                        <li><a href="/categories/Design Patterns/index.html">Design Patterns(1)</a></li>
                        
                        
                        <li><a href="/categories/IntelliJ/index.html">IntelliJ(1)</a></li>
                        
                        
                        <li><a href="/categories/Eclipse/index.html">Eclipse(1)</a></li>
                        
                        
                        <li><a href="/categories/Fedora/index.html">Fedora(4)</a></li>
                        
                        
                        <li><a href="/categories/Git/index.html">Git(1)</a></li>
                        
                        
                        <li><a href="/categories/JBoss/index.html">JBoss(1)</a></li>
                        
                        
                        <li><a href="/categories/Swing/index.html">Swing(2)</a></li>
                        
                        
                        <li><a href="/categories/NetBeans/index.html">NetBeans(1)</a></li>
                        
                        
                        <li><a href="/categories/LaTeX/index.html">LaTeX(1)</a></li>
                        
                        
                        <li><a href="/categories/Jekyll/index.html">Jekyll(2)</a></li>
                        
                        
                        <li><a href="/categories/Programming/index.html">Programming(5)</a></li>
                        
                        
                        <li><a href="/categories/Scala/index.html">Scala(2)</a></li>
                        
                        
                        <li><a href="/categories/Common Lisp/index.html">Common Lisp(2)</a></li>
                        
                        
                        <li><a href="/categories/Python/index.html">Python(1)</a></li>
                        
                        
                        <li><a href="/categories/Groovy/index.html">Groovy(1)</a></li>
                        
                        
                        <li><a href="/categories/Clojure/index.html">Clojure(1)</a></li>
                        
                        
                        <li><a href="/categories/Books/index.html">Books(1)</a></li>
                        
                    </ul>
                </div>
            </div>
        </div>
        <script type="text/javascript">
    var disqus_shortname = 'batsov'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
    </body>
</html>
