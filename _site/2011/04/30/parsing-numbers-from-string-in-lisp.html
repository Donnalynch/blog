<?xml version="1.0" encoding="UTF-8"?>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
    <head>
        <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
        <link href="/css/site.css" type="text/css" rel="stylesheet"/>
        <link rel="stylesheet" href="/css/syntax.css" type="text/css" />
        <link rel="alternate" type="application/atom+xml" href="atom.xml" title="Atom feed">
        <title>(think) - Parsing numbers from string in Common Lisp</title>

        <script type="text/javascript">
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-22917580-1']);
            _gaq.push(['_trackPageview']);

            (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
            })();

        </script>
    </head>

    <body>
        <div id="page">
            <div id="content">
                <div id="header">
                    <h1>(think)</h1>
                    <p class="comment">/** An online novel about the Source, the Force, the real life and everything
                    in between...**/</p>
                </div>
                <div id="middle">
                    <div id="menu">
                        <ul id="list-nav">
                            <li><a href="/index.html">Home</a></li>
                            <li><a href="/archive.html">Archive</a></li>
                            <li><a href="/projects.html">Projects</a></li>
                            <li><a href="/about.html">About</a></li>
                            <li><a href="/contacts.html">Contacts</a></li>
                        </ul>
                    </div>
                    <div id="content">
                        <div id="post">
    <h2 class="title">Parsing numbers from string in Common Lisp</h2>
    <p>One task that often recurs in programming is the need to parse a
string representation a number(or several numbers) and convert it to
its numeric value. Parsing integer value in Common Lisp is fairly
straightforward process - we have the built-in function <strong>PARSE-INTEGER</strong>:</p>

<div class="highlight"><pre><code class="cl"><span class="p">(</span><span class="nb">parse-integer</span> <span class="s">&quot;100&quot;</span><span class="p">)</span> <span class="c1">;; =&gt; 100</span>
<span class="p">(</span><span class="nb">parse-integer</span> <span class="s">&quot;100&quot;</span> <span class="ss">:radix</span> <span class="mi">2</span><span class="p">)</span> <span class="c1">;; =&gt; 4</span>
</code></pre>
</div>

<p>As you can see the function allows you to parse a string
representation of a number in an arbitrary base system(the default is
the <em>decimal</em>). With the keyword argument <strong>:radix</strong> you can specify a
base in the interval 2-36. The function has a few other fancy
capabilities as well - like the ability to process only a part of the
string that has been passed to it and to ignore junk in the input
string. For all the gory details refer to the
<a href="http://www.lispworks.com/documentation/HyperSpec/Body/f_parse_.htm">Lisp HyperSpec</a>.</p>

<p>The problem that most Lisper face soon after is that there is no
matching function PARSE-FLOAT or PARSE-DOUBLE. I’m not sure what
technical reason is hidden beneath this design decision, but I know of
simple way to parse floating point numbers non-the-less. It’s built
around the <strong>READ</strong>(The R in REPL) function that allows you read any
S-expression from a string form. The READ function then returns a Lisp
object corresponding to the S-expression read. With that knowledge and
the fact that READ accepts as an optional argument an input stream
from which to read that S-expression(the default is the the standard
input) we can write the following bit of parsing code:</p>

<div class="highlight"><pre><code class="cl"><span class="p">(</span><span class="nb">with-input-from-string</span> <span class="p">(</span><span class="nv">in</span> <span class="s">&quot;3.14&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">read</span> <span class="nv">in</span><span class="p">))</span>
</code></pre>
</div>

<p>Here we created an input stream that’s bound to the string “3.14” and
read one S-expression from it - the floating point object 3.14.</p>

<p>We can even build a more general solution that parses several numbers
in a string, regardless of their actual type(integer or floating
point):</p>

<div class="highlight"><pre><code class="cl"><span class="p">(</span><span class="nb">with-input-from-string</span> <span class="p">(</span><span class="nv">in</span> <span class="s">&quot;3.14 5.646 4 9.6&quot;</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">loop</span> <span class="nv">for</span> <span class="nv">x</span> <span class="nb">=</span> <span class="p">(</span><span class="nb">read</span> <span class="nv">in</span> <span class="no">nil</span> <span class="no">nil</span><span class="p">)</span> <span class="nv">while</span> <span class="nv">x</span> <span class="nv">collect</span> <span class="nv">x</span><span class="p">))</span>
<span class="c1">;; =&gt; (3.14 5.646 4 9.6)</span>
</code></pre>
</div>

<p>Hopefully this short article has been helpful. You’ve also witnessed
one of the practical benefits of having the code in Lisp represented
as data.</p>

    <div style="font-style: italic; color: #7f9f7f;">Posted on 30 Apr 2011 by Bozhidar.</div>
    <br/>
        <span  class='st_reddit_large' ></span><span  class='st_linkedin_large' ></span><span  class='st_google_reader_large' ></span><span  class='st_dzone_large' ></span><span  class='st_digg_large' ></span><span  class='st_twitter_large' ></span><span  class='st_facebook_large' ></span><span  class='st_yahoo_large' ></span><span  class='st_gbuzz_large' ></span><span  class='st_email_large' ></span><span  class='st_sharethis_large' ></span>
    <hr />
    <div id="disqus">
        <div id="disqus_thread"></div>
<script type="text/javascript">
    var disqus_shortname = 'batsov'; // required: replace example with your forum shortname

    // The following are highly recommended additional parameters. Remove the slashes in front to use.
    var disqus_identifier = document.location.href;
    var disqus_url = document.location.href;

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<script type="text/javascript">var switchTo5x=true;</script><script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script><script type="text/javascript">stLight.options({publisher:'e857ac4f-d3f6-4aa1-9e1f-06210ab5480e'});</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>
</div>

                    </div>
                </div>
                <div id="footer">
                    Copyright &copy; 2010-2011 <a href="mailto:bozhidar.batsov@gmail.com">Bozhidar Batsov</a>. All Rights Reserved.
                    <br/>
                    Powered by <a href="http://jekyllrb.com/">Jekyll</a>.
                </div>
            </div>
            <div id="sidebar">
                <div id="twitter">
                    <script src="http://widgets.twimg.com/j/2/widget.js" type="text/javascript"></script>
                    <script type="text/javascript">
                        new TWTR.Widget({
                        version: 2,
                        type: 'profile',
                        rpp: 4,
                        interval: 6000,
                        width: 250,
                        height: 300,
                        theme: {
                        shell: {
                        background: '#333333',
                        color: '#ffffff'
                        },
                        tweets: {
                        background: '#000000',
                        color: '#ffffff',
                        links: '#4aed05'
                        }
                        },
                        features: {
                        scrollbar: false,
                        loop: false,
                        live: false,
                        hashtags: true,
                        timestamp: true,
                        avatars: false,
                        behavior: 'all'
                        }
                        }).render().setUser('bbatsov').start();
                    </script>
                </div>
            </div>
        </div>
        <script type="text/javascript">
    var disqus_shortname = 'batsov'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://' + disqus_shortname + '.disqus.com/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
    </body>
</html>
